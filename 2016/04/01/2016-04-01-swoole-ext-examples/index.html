<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="swoole&amp;#x6269;&amp;#x5C55;&amp;#x6837;&amp;#x4F8B;&amp;#x7B14;&amp;#x8BB0;1.8.4&amp;#x7248;&amp;#x672C;
&amp;#x8FFD;&amp;#x8E2A;&amp;#x6D41;&amp;#x7A0B;123451.&amp;#x9996;&amp;#x5148;&amp;#x8BF7;&amp;#x4F7F;&amp;#x7528;ps aux&amp;#x5217;&amp;#x51FA;&amp;#x6240;&amp;#x6709;&amp;#x8FDB">
<meta property="og:type" content="article">
<meta property="og:title" content="swoole-ext-examples swoole扩展样例笔记">
<meta property="og:url" content="http://yoursite.com/2016/04/01/2016-04-01-swoole-ext-examples/index.html">
<meta property="og:site_name" content="Neconano's notebook">
<meta property="og:description" content="swoole&amp;#x6269;&amp;#x5C55;&amp;#x6837;&amp;#x4F8B;&amp;#x7B14;&amp;#x8BB0;1.8.4&amp;#x7248;&amp;#x672C;
&amp;#x8FFD;&amp;#x8E2A;&amp;#x6D41;&amp;#x7A0B;123451.&amp;#x9996;&amp;#x5148;&amp;#x8BF7;&amp;#x4F7F;&amp;#x7528;ps aux&amp;#x5217;&amp;#x51FA;&amp;#x6240;&amp;#x6709;&amp;#x8FDB">
<meta property="og:updated_time" content="2016-11-29T02:54:50.563Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="swoole-ext-examples swoole扩展样例笔记">
<meta name="twitter:description" content="swoole&amp;#x6269;&amp;#x5C55;&amp;#x6837;&amp;#x4F8B;&amp;#x7B14;&amp;#x8BB0;1.8.4&amp;#x7248;&amp;#x672C;
&amp;#x8FFD;&amp;#x8E2A;&amp;#x6D41;&amp;#x7A0B;123451.&amp;#x9996;&amp;#x5148;&amp;#x8BF7;&amp;#x4F7F;&amp;#x7528;ps aux&amp;#x5217;&amp;#x51FA;&amp;#x6240;&amp;#x6709;&amp;#x8FDB">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"right","display":"always"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/2016/04/01/2016-04-01-swoole-ext-examples/"/>

  <title> swoole-ext-examples swoole扩展样例笔记 | Neconano's notebook </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-right page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Neconano's notebook</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                swoole-ext-examples swoole扩展样例笔记
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-04-01T00:00:00+08:00" content="2016-04-01">
              2016-04-01
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/swoole/" itemprop="url" rel="index">
                    <span itemprop="name">swoole</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="swoole&#x6269;&#x5C55;&#x6837;&#x4F8B;&#x7B14;&#x8BB0;1-8-4&#x7248;&#x672C;"><a href="#swoole&#x6269;&#x5C55;&#x6837;&#x4F8B;&#x7B14;&#x8BB0;1-8-4&#x7248;&#x672C;" class="headerlink" title="swoole&#x6269;&#x5C55;&#x6837;&#x4F8B;&#x7B14;&#x8BB0;1.8.4&#x7248;&#x672C;"></a>swoole&#x6269;&#x5C55;&#x6837;&#x4F8B;&#x7B14;&#x8BB0;1.8.4&#x7248;&#x672C;</h1><hr>
<h3 id="&#x8FFD;&#x8E2A;&#x6D41;&#x7A0B;"><a href="#&#x8FFD;&#x8E2A;&#x6D41;&#x7A0B;" class="headerlink" title="&#x8FFD;&#x8E2A;&#x6D41;&#x7A0B;"></a>&#x8FFD;&#x8E2A;&#x6D41;&#x7A0B;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">1.&#x9996;&#x5148;&#x8BF7;&#x4F7F;&#x7528;ps aux&#x5217;&#x51FA;&#x6240;&#x6709;&#x8FDB;&#x7A0B;&#xFF0C;&#x770B;&#x770B;&#x662F;&#x54EA;&#x4E9B;&#x8FDB;&#x7A0B;&#x589E;&#x591A;&#x4E86;</div><div class="line">2.&#x4F7F;&#x7528;top&#x5DE5;&#x5177;&#x8DDF;&#x8E2A;&#x4EC0;&#x4E48;&#x8FDB;&#x7A0B;&#x5728;&#x5360;&#x7528;CPU&#xFF0C;&#x662F;swoole&#x7684;master&#x8FDB;&#x7A0B;&#x8FD8;&#x662F;worker&#x8FDB;&#x7A0B;&#x8FD8;&#x662F;manager&#x8FDB;&#x7A0B;&#x6216;&#x5176;&#x4ED6;&#xFF0C;&#x5206;&#x522B;&#x5360;&#x7528;&#x4E86;&#x591A;&#x5C11;CPU&#xFF0C;&#x5B9A;&#x4F4D;&#x5230;&#x662F;&#x54EA;&#x4E9B;&#x8FDB;&#x7A0B;&#x51FA;&#x4E86;&#x95EE;&#x9898;&#x3002;&#x53E6;&#x5916;&#xFF0C;top&#x5DE5;&#x5177;&#x8FD8;&#x6709;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x662F;sys&#x5185;&#x6838;&#x6001;CPU&#x3001;usr&#x7528;&#x6237;&#x6001;CPU&#x3001;si&#x8F6F;&#x4E2D;&#x65AD;&#x54EA;&#x4E9B;&#x5360;&#x7528;&#x9AD8;&#x3002;</div><div class="line">3.&#x4F7F;&#x7528;strace&#x5DE5;&#x5177;&#x8DDF;&#x8E2A;&#x95EE;&#x9898;&#x8FDB;&#x7A0B;&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;</div><div class="line">4.&#x4F7F;&#x7528;gdb -p &#x548C; zbacktrace&#x8DDF;&#x8E2A;&#x95EE;&#x9898;&#x8FDB;&#x7A0B;&#x6B63;&#x5728;&#x6267;&#x884C;&#x4EC0;&#x4E48;C&#x51FD;&#x6570;&#x548C;PHP&#x51FD;&#x6570;&#xFF0C;&#x4F7F;&#x7528;bt&#x6307;&#x4EE4;&#x548C;zbacktrace&#x6253;&#x5370;&#x8C03;&#x7528;&#x6808;</div><div class="line">5.&#x4ECE;PHP&#x9519;&#x8BEF;&#x65E5;&#x5FD7;&#x548C;swoole&#x7684;log_file&#x4E2D;&#x67E5;&#x627E;&#x95EE;&#x9898;</div></pre></td></tr></table></figure>
<h3 id="&#x914D;&#x7F6E;&#x53C2;&#x6570;"><a href="#&#x914D;&#x7F6E;&#x53C2;&#x6570;" class="headerlink" title="&#x914D;&#x7F6E;&#x53C2;&#x6570;"></a>&#x914D;&#x7F6E;&#x53C2;&#x6570;</h3><p>./configure &#x2013;enable-async-mysql &#x2013;enable-openssl &#x2013;enable-sockets</p>
<h3 id="&#x57FA;&#x672C;&#x6982;&#x5FF5;"><a href="#&#x57FA;&#x672C;&#x6982;&#x5FF5;" class="headerlink" title="&#x57FA;&#x672C;&#x6982;&#x5FF5;"></a>&#x57FA;&#x672C;&#x6982;&#x5FF5;</h3><p><code>swoole_server</code>&#x5F3A;&#x5927;&#x7684;TCP/UDP Server&#x6846;&#x67B6;</p>
<p><code>swoole_http_server</code>&#x7EE7;&#x627F;&#x81EA;<code>swoole_server</code>&#x662F;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;http&#x670D;&#x52A1;&#x5668;&#x5B9E;&#x73B0;</p>
<p><code>swoole_websocket_server</code>&#x662F;<code>swoole_http_server</code>&#x7684;&#x5B50;&#x7C7B;&#xFF0C;&#x5185;&#x7F6E;&#x4E86;WebSocket&#x7684;&#x652F;&#x6301;</p>
<p><code>swoole_client</code>TCP/UDP&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x652F;&#x6301;&#x540C;&#x6B65;&#x5E76;&#x53D1;&#x8C03;&#x7528;&#xFF0C;&#x4E5F;&#x652F;&#x6301;&#x5F02;&#x6B65;&#x4E8B;&#x4EF6;&#x9A71;&#x52A8;&#x3002;</p>
<p><code>swoole_event</code>EventLoop API&#xFF0C;&#x8BA9;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x64CD;&#x4F5C;&#x5E95;&#x5C42;&#x7684;&#x4E8B;&#x4EF6;&#x5FAA;&#x73AF;&#xFF0C;&#x5C06;socket&#xFF0C;stream&#xFF0C;&#x7BA1;&#x9053;&#x7B49;Linux&#x6587;&#x4EF6;&#x52A0;&#x5165;&#x5230;&#x4E8B;&#x4EF6;&#x5FAA;&#x73AF;&#x4E2D;&#x3002;</p>
<p><code>swoole_async</code>&#x5F02;&#x6B65;IO&#x63A5;&#x53E3;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86; &#x5F02;&#x6B65;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;IO&#xFF0C;&#x5F02;&#x6B65;DNS&#x67E5;&#x8BE2;&#xFF0C;&#x5F02;&#x6B65;MySQL&#x7B49;API</p>
<p><code>swoole_process</code>&#x8FDB;&#x7A0B;&#x7BA1;&#x7406;&#x6A21;&#x5757;&#xFF0C;&#x53EF;&#x4EE5;&#x65B9;&#x4FBF;&#x7684;&#x521B;&#x5EFA;&#x5B50;&#x8FDB;&#x7A0B;&#xFF0C;&#x8FDB;&#x7A0B;&#x95F4;&#x901A;&#x4FE1;&#xFF0C;&#x8FDB;&#x7A0B;&#x7BA1;&#x7406;&#x3002;</p>
<p><code>swoole_table</code>&#x57FA;&#x4E8E;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x548C;&#x81EA;&#x65CB;&#x9501;&#x5B9E;&#x73B0;&#x7684;&#x8D85;&#x9AD8;&#x6027;&#x80FD;&#x5185;&#x5B58;&#x8868;&#x3002;</p>
<p><code>swoole_buffer</code>&#x5F3A;&#x5927;&#x7684;&#x5185;&#x5B58;&#x533A;&#x7BA1;&#x7406;&#x5DE5;&#x5177;</p>
<h3 id="1-version-php-&#x8F93;&#x51FA;&#x7248;&#x672C;&#x4FE1;&#x606F;&#xFF0C;&#x4F8B;&#x5982;-1-8-4"><a href="#1-version-php-&#x8F93;&#x51FA;&#x7248;&#x672C;&#x4FE1;&#x606F;&#xFF0C;&#x4F8B;&#x5982;-1-8-4" class="headerlink" title="1.version.php &#x8F93;&#x51FA;&#x7248;&#x672C;&#x4FE1;&#x606F;&#xFF0C;&#x4F8B;&#x5982; 1.8.4"></a>1.version.php &#x8F93;&#x51FA;&#x7248;&#x672C;&#x4FE1;&#x606F;&#xFF0C;&#x4F8B;&#x5982; 1.8.4</h3><p>echo SWOOLE_VERSION,&#x201D;\n&#x201D;;</p>
<p>echo swoole_version();</p>
<h3 id="2-timer-php-&#x5B9A;&#x65F6;&#x5668;&#x6837;&#x4F8B;"><a href="#2-timer-php-&#x5B9A;&#x65F6;&#x5668;&#x6837;&#x4F8B;" class="headerlink" title="2.timer.php &#x5B9A;&#x65F6;&#x5668;&#x6837;&#x4F8B;"></a>2.timer.php &#x5B9A;&#x65F6;&#x5668;&#x6837;&#x4F8B;</h3><p><code>swoole_timer_add</code>&#x5DF2;&#x88AB;<code>swoole_timer_tick</code>&#x66FF;&#x6362;</p>
<p><code>swoole_timer_del</code>&#x5DF2;&#x88AB;<code>swoole_timer_clear</code>&#x66FF;&#x6362;</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$id = swoole_timer_tick(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span><span class="params">($interval)</span> </span>{}</div><div class="line"><span class="comment">//$interval&#x4E0E;$id&#x4EE3;&#x8868;&#x5B9A;&#x65F6;&#x5668;&#x7684;id</span></div><div class="line">swoole_timer_clear($id)<span class="comment">//&#x505C;&#x6B62;&#x5B9A;&#x65F6;&#x5668;</span></div></pre></td></tr></table></figure>
<h3 id="3-test-buffer-php-&#x4EE5;&#x963B;&#x585E;&#x65B9;&#x5F0F;&#x53D1;&#x9001;&#x4FE1;&#x606F;&#x5230;&#x670D;&#x52A1;&#x5668;"><a href="#3-test-buffer-php-&#x4EE5;&#x963B;&#x585E;&#x65B9;&#x5F0F;&#x53D1;&#x9001;&#x4FE1;&#x606F;&#x5230;&#x670D;&#x52A1;&#x5668;" class="headerlink" title="3.test_buffer.php &#x4EE5;&#x963B;&#x585E;&#x65B9;&#x5F0F;&#x53D1;&#x9001;&#x4FE1;&#x606F;&#x5230;&#x670D;&#x52A1;&#x5668;"></a>3.test_buffer.php &#x4EE5;&#x963B;&#x585E;&#x65B9;&#x5F0F;&#x53D1;&#x9001;&#x4FE1;&#x606F;&#x5230;&#x670D;&#x52A1;&#x5668;</h3><p><code>swoole_client</code>&#x5728;php-fpm/apache&#x4E2D;&#x521B;&#x5EFA;&#x957F;&#x8FDE;&#x63A5;,&#x540C;&#x6B65;&#x963B;&#x585E;</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$client-&gt;send(str_repeat(<span class="string">&quot;A&quot;</span>, <span class="number">8000</span>).$i.<span class="string">&quot;[0]&quot;</span>);</div></pre></td></tr></table></figure>
<p>&#x7A0B;&#x5E8F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x4EE5;&#x963B;&#x585E;&#x65B9;&#x5F0F;&#x53D1;&#x9001;&#x4FE1;&#x606F;&#x5230;&#x670D;&#x52A1;&#x5668;</p>
<h3 id="4-swoole-http-client-php-swoole-http-client-&#x5DF2;&#x7ECF;&#x88AB;&#x5E9F;&#x5F03;"><a href="#4-swoole-http-client-php-swoole-http-client-&#x5DF2;&#x7ECF;&#x88AB;&#x5E9F;&#x5F03;" class="headerlink" title="4.swoole_http_client.php swoole_http_client &#x5DF2;&#x7ECF;&#x88AB;&#x5E9F;&#x5F03;"></a>4.<code>swoole_http_client.php</code> swoole_http_client &#x5DF2;&#x7ECF;&#x88AB;&#x5E9F;&#x5F03;</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$route = $request-&gt;server[<span class="string">&apos;request_uri&apos;</span>];<span class="comment">//Http&#x8BF7;&#x6C42;&#x76F8;&#x5173;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4FE1;&#x606F;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;PHP&#x7684;$_SERVER&#x6570;&#x7EC4;</span></div><div class="line">$response-&gt;end(json_encode($request));<span class="comment">//&#x53D1;&#x9001;Http&#x54CD;&#x5E94;&#x4F53;&#xFF0C;&#x5E76;&#x7ED3;&#x675F;&#x8BF7;&#x6C42;&#x5904;&#x7406;&#x3002;</span></div></pre></td></tr></table></figure>
<h3 id="5-swoole-php-swoole&#x67B6;&#x6784;&#x7684;&#x8BF4;&#x660E;&#x6587;&#x4EF6;"><a href="#5-swoole-php-swoole&#x67B6;&#x6784;&#x7684;&#x8BF4;&#x660E;&#x6587;&#x4EF6;" class="headerlink" title="5.swoole.php swoole&#x67B6;&#x6784;&#x7684;&#x8BF4;&#x660E;&#x6587;&#x4EF6;"></a>5.<code>swoole.php</code> swoole&#x67B6;&#x6784;&#x7684;&#x8BF4;&#x660E;&#x6587;&#x4EF6;</h3><h3 id="6-swoole-process-php-&#x5C06;&#x8FDB;&#x7A0B;&#x7ED1;&#x5B9A;&#x5230;&#x7279;&#x5B9A;&#x7684;CPU&#x6838;&#x4E0A;"><a href="#6-swoole-process-php-&#x5C06;&#x8FDB;&#x7A0B;&#x7ED1;&#x5B9A;&#x5230;&#x7279;&#x5B9A;&#x7684;CPU&#x6838;&#x4E0A;" class="headerlink" title="6.swoole_process.php &#x5C06;&#x8FDB;&#x7A0B;&#x7ED1;&#x5B9A;&#x5230;&#x7279;&#x5B9A;&#x7684;CPU&#x6838;&#x4E0A;"></a>6.<code>swoole_process.php</code> &#x5C06;&#x8FDB;&#x7A0B;&#x7ED1;&#x5B9A;&#x5230;&#x7279;&#x5B9A;&#x7684;CPU&#x6838;&#x4E0A;</h3><p>swoole_process::setaffinity(array(0, 2));//&#x63A5;&#x53D7;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#x53C2;&#x6570;&#x8868;&#x793A;&#x7ED1;&#x5B9A;&#x54EA;&#x4E9B;CPU&#x6838;&#xFF0C;&#x5982;array(0,2,3)&#x8868;&#x793A;&#x7ED1;&#x5B9A;CPU0/CPU2/CPU3 </p>
<h3 id="7-server-hot-update-opcache-php-&#x70ED;&#x542F;&#x52A8;opcache&#x670D;&#x52A1;"><a href="#7-server-hot-update-opcache-php-&#x70ED;&#x542F;&#x52A8;opcache&#x670D;&#x52A1;" class="headerlink" title="7.server_hot_update_opcache.php &#x70ED;&#x542F;&#x52A8;opcache&#x670D;&#x52A1;"></a>7.<code>server_hot_update_opcache.php</code> &#x70ED;&#x542F;&#x52A8;opcache&#x670D;&#x52A1;</h3><p>&#x70ED;&#x542F;&#x52A8;opcache&#x670D;&#x52A1;&#xFF0C;&#x63A5;&#x6536;&#x5230;reload&#x547D;&#x4EE4;&#x8C03;&#x7528;$serv-&gt;reload($serv)&#x91CD;&#x542F;&#x6240;&#x6709;worker&#x8FDB;&#x7A0B;&#xFF0C;&#x89E6;&#x53D1;my_onWorkerStart&#x5B9E;&#x73B0;</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">my_onWorkerStart</span><span class="params">($serv, $worker_id)</span></span></div><div class="line">{</div><div class="line">    <span class="keyword">global</span> $argv;</div><div class="line">    <span class="keyword">global</span> $class;</div><div class="line">    opcache_reset();<span class="comment">//&#x6240;&#x6709;&#x7684;&#x811A;&#x672C;&#x5C06;&#x4F1A;&#x91CD;&#x65B0;&#x8F7D;&#x5165;&#x5E76;&#x4E14;&#x5728;&#x4E0B;&#x6B21;&#x88AB;&#x70B9;&#x51FB;&#x7684;&#x65F6;&#x5019;&#x91CD;&#x65B0;&#x89E3;&#x6790;&#x3002;</span></div><div class="line">    <span class="keyword">include</span> <span class="string">&quot;hot_update_class.php&quot;</span>;</div><div class="line">    $class = <span class="keyword">new</span> HotUpdate();<span class="comment">//&#x5728;worker&#x8FDB;&#x7A0B;/task&#x8FDB;&#x7A0B;&#x542F;&#x52A8;&#x65F6;,&#x5BF9;&#x5168;&#x5C40;class&#x8D4B;&#x503C;</span></div><div class="line">    <span class="keyword">if</span>($worker_id &gt;= $serv-&gt;setting[<span class="string">&apos;worker_num&apos;</span>]) { <span class="comment">//&#x8868;&#x793A;&#x8FD9;&#x4E2A;&#x8FDB;&#x7A0B;&#x662F;task_worker</span></div><div class="line">        swoole_set_process_name(<span class="string">&quot;php {$argv[0]} task worker&quot;</span>);<span class="comment">//&#x4E3A;task_worker&#x548C;worker&#x8FDB;&#x7A0B;&#x91CD;&#x547D;&#x540D;</span></div><div class="line">    } <span class="keyword">else</span> {</div><div class="line">        swoole_set_process_name(<span class="string">&quot;php {$argv[0]} event worker&quot;</span>);<span class="comment">//&#x4E3A;task_worker&#x548C;worker&#x8FDB;&#x7A0B;&#x91CD;&#x547D;&#x540D;</span></div><div class="line">    }</div><div class="line">    <span class="comment">//echo &quot;WorkerStart|MasterPid={$serv-&gt;master_pid}|Manager_pid={$serv-&gt;manager_pid}|WorkerId=$worker_id\n&quot;;</span></div><div class="line">	<span class="comment">//$serv-&gt;addtimer(500); //&#x8BE5;&#x65B9;&#x6CD5;&#x88AB;tick&#x53D6;&#x4EE3;&#xFF0C;500ms &#x4E0E; swoole_server_addtimer &#x529F;&#x80FD;&#x76F8;&#x540C;</span></div><div class="line">}</div></pre></td></tr></table></figure>
<p>&#x53D1;&#x9001;&#x547D;&#x4EE4;&#x65B9;&#x5F0F;&#xFF1A;</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">$c = <span class="keyword">new</span> swoole_client(SWOOLE_TCP);</div><div class="line">$c-&gt;connect(<span class="string">&apos;127.0.0.1&apos;</span>, <span class="number">9501</span>);</div><div class="line">$c-&gt;send(<span class="string">&quot;reload&quot;</span>);<span class="comment">//&#x53D1;&#x9001;&#x91CD;&#x542F;&#x547D;&#x4EE4;</span></div><div class="line"></div><div class="line">&#x53EF;&#x901A;&#x8FC7;curl http:<span class="comment">//127.0.0.1:9501?aaa=111 &#x6D4B;&#x8BD5;&#x901A;&#x4FE1;&#xFF0C;&#x670D;&#x52A1;&#x7AEF;&#x4F1A;&#x6253;&#x5370;</span></div><div class="line">GET /?aaa=<span class="number">111</span> HTTP/<span class="number">1.1</span></div><div class="line">User-Agent: curl/<span class="number">7.35</span><span class="number">.0</span></div><div class="line">Host: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">9501</span></div><div class="line">Accept: *<span class="comment">/*</span></div></pre></td></tr></table></figure>
<h3 id="7-server-php-&#x591A;&#x8FDB;&#x7A0B;&#x6A21;&#x5F0F;&#x670D;&#x52A1;"><a href="#7-server-php-&#x591A;&#x8FDB;&#x7A0B;&#x6A21;&#x5F0F;&#x670D;&#x52A1;" class="headerlink" title="7.server.php &#x591A;&#x8FDB;&#x7A0B;&#x6A21;&#x5F0F;&#x670D;&#x52A1;"></a>7.<code>server.php</code> &#x591A;&#x8FDB;&#x7A0B;&#x6A21;&#x5F0F;&#x670D;&#x52A1;</h3><p>$serv-&gt;addprocess($process1);&#x6267;&#x884C;&#x540E;&#xFF08;&#x7B49;&#x5F85;1000&#x79D2;&#xFF09;&#x63D0;&#x793A;</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ERROR   zm_deactivate_swoole (ERROR <span class="number">9003</span>): worker process is terminated by <span class="keyword">exit</span>()/<span class="keyword">die</span>().</div></pre></td></tr></table></figure>
<p>&#x539F;&#x56E0;&#xFF1A;&#x521B;&#x5EFA;&#x7684;&#x8FDB;&#x7A0B;&#x5E94;&#x8BE5;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x4EE3;&#x7801;&#xFF0C;&#x6240;&#x4EE5;&#x7ACB;&#x5373;&#x9000;&#x51FA;&#x4E86;&#xFF0C;&#x4E3B;&#x8FDB;&#x7A0B;&#x53C8;&#x4F1A;&#x91CD;&#x65B0;&#x62C9;&#x8D77;&#x3002;&#x8FD9;&#x6837;&#x5C31;&#x9020;&#x6210;&#x6B7B;&#x5FAA;&#x73AF;&#x4E86;&#x3002;</p>
<p>&#x6267;&#x884C;$serv-&gt;addprocess($process2);&#x4E0D;&#x4F1A;&#x63D0;&#x793A;</p>
<h3 id="8-sendfile-server-php-&#x53D1;&#x9001;&#x6570;&#x636E;"><a href="#8-sendfile-server-php-&#x53D1;&#x9001;&#x6570;&#x636E;" class="headerlink" title="8.sendfile_server.php &#x53D1;&#x9001;&#x6570;&#x636E;"></a>8.<code>sendfile_server.php</code> &#x53D1;&#x9001;&#x6570;&#x636E;</h3><p>&#x53D1;&#x9001;&#x6587;&#x4EF6;&#x4FE1;&#x606F;&#x548C;&#x6587;&#x4EF6;&#x5230;&#x5BA2;&#x6237;&#x7AEF;,&#x5BF9;&#x5E94;<code>recv_file.php</code><br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$serv-&gt;send($fd, filesize(<span class="keyword">__DIR__</span>.<span class="string">&apos;/test.jpg&apos;</span>));</div><div class="line">$serv-&gt;sendfile($fd, <span class="keyword">__DIR__</span>.<span class="string">&apos;/test.jpg&apos;</span>);</div></pre></td></tr></table></figure></p>
<h3 id="9-recv-file-php-&#x63A5;&#x6536;&#x670D;&#x52A1;&#x5668;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;"><a href="#9-recv-file-php-&#x63A5;&#x6536;&#x670D;&#x52A1;&#x5668;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;" class="headerlink" title="9.recv_file.php &#x63A5;&#x6536;&#x670D;&#x52A1;&#x5668;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;"></a>9.<code>recv_file.php</code> &#x63A5;&#x6536;&#x670D;&#x52A1;&#x5668;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//&#x5FAA;&#x73AF;&#x63A5;&#x6536;&#xFF0C;&#x9002;&#x5408;&#x5927;&#x578B;&#x6587;&#x4EF6;</span></div><div class="line"><span class="keyword">while</span>(<span class="number">1</span>)</div><div class="line">{</div><div class="line">    <span class="comment">//&#x8D85;&#x5927;&#x6587;&#x4EF6;&#x63A5;&#x6536;&#xFF0C;&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x6539;&#x6210;&#x5206;&#x6BB5;&#x5199;&#x78C1;&#x76D8;</span></div><div class="line">    $content .= $cli-&gt;recv();</div><div class="line">    <span class="keyword">if</span> (strlen($content) == $filesize)</div><div class="line">    {</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    }</div><div class="line">}</div><div class="line">file_put_contents(<span class="keyword">__DIR__</span>.<span class="string">&quot;/recv_file_&quot;</span>.time().<span class="string">&quot;.jpg&quot;</span>, $content);</div></pre></td></tr></table></figure>
<h3 id="10-send-1m-svr-php-&#x53D1;&#x9001;1m&#x6570;&#x636E;"><a href="#10-send-1m-svr-php-&#x53D1;&#x9001;1m&#x6570;&#x636E;" class="headerlink" title="10.send_1m_svr.php &#x53D1;&#x9001;1m&#x6570;&#x636E;"></a>10.<code>send_1m_svr.php</code> &#x53D1;&#x9001;1m&#x6570;&#x636E;</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">$serv-&gt;on(<span class="string">&apos;receive&apos;</span>, <span class="function"><span class="keyword">function</span> <span class="params">($serv, $fd, $from_id, $data)</span> </span>{</div><div class="line">    <span class="comment">//echo &quot;[#&quot;.posix_getpid().&quot;]\tClient[$fd]: $data\n&quot;;</span></div><div class="line">    $array = <span class="keyword">array</span>(<span class="string">&apos;A&apos;</span>, <span class="string">&apos;B&apos;</span>, <span class="string">&apos;C&apos;</span>, <span class="string">&apos;D&apos;</span>, <span class="string">&apos;E&apos;</span>, <span class="string">&apos;F&apos;</span>, <span class="string">&apos;G&apos;</span>);</div><div class="line">    $data = <span class="string">&apos;&apos;</span>;</div><div class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>; $i&lt; <span class="number">125</span>; $i++)</div><div class="line">    {</div><div class="line">        $data = str_repeat($array[$i%<span class="number">7</span>], <span class="number">4030</span>).<span class="string">&quot;\n&quot;</span>;</div><div class="line">        $serv-&gt;send($fd, $data);</div><div class="line">    }</div><div class="line">    <span class="comment">//$serv-&gt;send($fd, &quot;swoole: $data&quot;);</span></div><div class="line">    <span class="comment">//$serv-&gt;close($fd);</span></div><div class="line">});</div></pre></td></tr></table></figure>
<h3 id="11-recv-1m-client-php-&#x63A5;&#x6536;1m&#x6570;&#x636E;"><a href="#11-recv-1m-client-php-&#x63A5;&#x6536;1m&#x6570;&#x636E;" class="headerlink" title="11.recv_1m_client.php &#x63A5;&#x6536;1m&#x6570;&#x636E;"></a>11.<code>recv_1m_client.php</code> &#x63A5;&#x6536;1m&#x6570;&#x636E;</h3><p>&#x63A5;&#x6536;&#x6570;&#x636E;&#x5E76;&#x5199;&#x5165;data.log</p>
<p>&#x63D0;&#x793A;&#x9519;&#x8BEF;&#xFF1A;PHP Warning:  swoole_client::recv(): recv() failed. Error: Resource temporarily unavailable</p>
<p>&#x4E00;&#x65E6;&#x8D85;&#x65F6;&#x5C31;&#x4F1A;&#x63D0;&#x793A;&#x9519;&#x8BEF;&#xFF0C;&#x5C06;&#x670D;&#x52A1;&#x7AEF;&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#x6CE8;&#x91CA;&#x53BB;&#x6389;&#x6B63;&#x5E38;</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$serv-&gt;send($fd, <span class="string">&quot;swoole: $data&quot;</span>);</div><div class="line">$serv-&gt;close($fd);<span class="comment">//&#x5173;&#x95ED;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;</span></div></pre></td></tr></table></figure>
<h3 id="12-reflection-test-php-&#x62A5;&#x544A;swoole-server&#x7C7B;&#x7684;&#x6709;&#x5173;&#x4FE1;&#x606F;"><a href="#12-reflection-test-php-&#x62A5;&#x544A;swoole-server&#x7C7B;&#x7684;&#x6709;&#x5173;&#x4FE1;&#x606F;" class="headerlink" title="12.reflection_test.php &#x62A5;&#x544A;swoole_server&#x7C7B;&#x7684;&#x6709;&#x5173;&#x4FE1;&#x606F;"></a>12.<code>reflection_test.php</code> &#x62A5;&#x544A;swoole_server&#x7C7B;&#x7684;&#x6709;&#x5173;&#x4FE1;&#x606F;</h3><p>ReflectionClass &#x7C7B;&#x62A5;&#x544A;&#x4E86;&#x4E00;&#x4E2A;&#x7C7B;&#x7684;&#x6709;&#x5173;&#x4FE1;&#x606F;&#x3002;</p>
<p>&#x90E8;&#x5206;&#x8F93;&#x51FA;&#x5185;&#x5BB9;</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">----------------------------------------</div><div class="line">method name : __construct</div><div class="line">----------------------------------------</div><div class="line"><span class="keyword">Array</span></div><div class="line">(</div><div class="line">    [<span class="number">0</span>] =&gt; ReflectionParameter Object</div><div class="line">        (</div><div class="line">            [name] =&gt; serv_host</div><div class="line">        )</div><div class="line"></div><div class="line">    [<span class="number">1</span>] =&gt; ReflectionParameter Object</div><div class="line">        (</div><div class="line">            [name] =&gt; serv_port</div><div class="line">        )</div><div class="line"></div><div class="line">    [<span class="number">2</span>] =&gt; ReflectionParameter Object</div><div class="line">        (</div><div class="line">            [name] =&gt; serv_mode</div><div class="line">        )</div><div class="line"></div><div class="line">    [<span class="number">3</span>] =&gt; ReflectionParameter Object</div><div class="line">        (</div><div class="line">            [name] =&gt; sock_type</div><div class="line">        )</div><div class="line"></div><div class="line">)</div></pre></td></tr></table></figure>
<h3 id="13-redis-pool-php-redis&#x8FDE;&#x63A5;&#x6C60;&#x670D;&#x52A1;"><a href="#13-redis-pool-php-redis&#x8FDE;&#x63A5;&#x6C60;&#x670D;&#x52A1;" class="headerlink" title="13.redis_pool.php redis&#x8FDE;&#x63A5;&#x6C60;&#x670D;&#x52A1;"></a>13.<code>redis_pool.php</code> redis&#x8FDE;&#x63A5;&#x6C60;&#x670D;&#x52A1;</h3><p>redis&#x8FDE;&#x63A5;&#x6C60;&#x670D;&#x52A1;,&#x591A;&#x8FDB;&#x7A0B;swoole_server&#x670D;&#x52A1;&#xFF0C;&#x6536;&#x5230;&#x8BF7;&#x6C42;&#x540E;&#x542F;&#x52A8;&#x4EFB;&#x52A1;&#x5904;&#x7406;</p>
<p>&#x538B;&#x529B;&#x6D4B;&#x8BD5;</p>
<p>php bench/run.php </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">onReceive(&#x542F;&#x52A8;taskwait) -&gt; onTask(&#x8FDE;&#x63A5;redis) -&gt; onReceive(&#x5904;&#x7406;&#x4E1A;&#x52A1;)</div></pre></td></tr></table></figure>
<h3 id="14-db-pool-php-mysql&#x548C;&#x8FDE;&#x63A5;&#x6C60;&#x670D;&#x52A1;"><a href="#14-db-pool-php-mysql&#x548C;&#x8FDE;&#x63A5;&#x6C60;&#x670D;&#x52A1;" class="headerlink" title="14.db_pool.php mysql&#x548C;&#x8FDE;&#x63A5;&#x6C60;&#x670D;&#x52A1;"></a>14.<code>db_pool.php</code> mysql&#x548C;&#x8FDE;&#x63A5;&#x6C60;&#x670D;&#x52A1;</h3><p>mysql&#x548C;&#x8FDE;&#x63A5;&#x6C60;&#x670D;&#x52A1;&#xFF0C;&#x548C;redis&#x7C7B;&#x4F3C;</p>
<h3 id="15-proxy-sync-php-&#x540C;&#x6B65;&#x4EE3;&#x7406;&#x670D;&#x52A1;"><a href="#15-proxy-sync-php-&#x540C;&#x6B65;&#x4EE3;&#x7406;&#x670D;&#x52A1;" class="headerlink" title="15.proxy_sync.php &#x540C;&#x6B65;&#x4EE3;&#x7406;&#x670D;&#x52A1;"></a>15.<code>proxy_sync.php</code> &#x540C;&#x6B65;&#x4EE3;&#x7406;&#x670D;&#x52A1;</h3><p>&#x540C;&#x6B65;&#x4EE3;&#x7406;&#x670D;&#x52A1;</p>
<p>$serv = new swoole_server(&#x201C;127.0.0.1&#x201D;, 9509);</p>
<p>$socket = new swoole_client(SWOOLE_SOCK_TCP);</p>
<h3 id="16-proxy-php-&#x5F02;&#x6B65;&#x4EE3;&#x7406;&#x670D;&#x52A1;"><a href="#16-proxy-php-&#x5F02;&#x6B65;&#x4EE3;&#x7406;&#x670D;&#x52A1;" class="headerlink" title="16.proxy.php &#x5F02;&#x6B65;&#x4EE3;&#x7406;&#x670D;&#x52A1;"></a>16.<code>proxy.php</code> &#x5F02;&#x6B65;&#x4EE3;&#x7406;&#x670D;&#x52A1;</h3><p>&#x5F02;&#x6B65;&#x4EE3;&#x7406;&#x670D;&#x52A1;</p>
<p>$serv = new swoole_server(&#x201C;127.0.0.1&#x201D;, 9509, SWOOLE_BASE);</p>
<p>$socket = new swoole_client(SWOOLE_SOCK_TCP, SWOOLE_SOCK_ASYNC);</p>
<p>&#x538B;&#x529B;&#x6D4B;&#x8BD5;</p>
<p>php bench/run.php -n 1000 -c 100 -s tcp://127.0.0.1:9509 -f short_tcp / long_tcp</p>
<p>&#x5728;worker_num&#x76F8;&#x540C;&#x60C5;&#x51B5;&#x4E0B;&#x4E24;&#x79CD;&#x6A21;&#x5F0F;&#x6027;&#x80FD;&#x57FA;&#x672C;&#x76F8;&#x540C;</p>
<h3 id="17-mysql-proxy-server-php-mysql&#x8FDE;&#x63A5;&#x6C60;"><a href="#17-mysql-proxy-server-php-mysql&#x8FDE;&#x63A5;&#x6C60;" class="headerlink" title="17.mysql_proxy_server.php mysql&#x8FDE;&#x63A5;&#x6C60;"></a>17.<code>mysql_proxy_server.php</code> mysql&#x8FDE;&#x63A5;&#x6C60;</h3><p>mysql&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x6C60;&#xFF0C;&#x7528;&#x4E8E;&#x5927;&#x89C4;&#x6A21;&#x5E76;&#x53D1;&#x4E0B;&#xFF08;1w&#x4E2A;&#x8FDE;&#x63A5;&#xFF09;&#x8FDE;&#x63A5;Mysql&#x7EBF;&#x7A0B;&#x95F4;&#x4E0A;&#x4E0B;&#x6587;&#x5207;&#x6362;&#x95EE;&#x9898;<a href="http://wiki.swoole.com/wiki/page/122.html" target="_blank" rel="external">&#x6269;&#x5C55;</a></p>
<p>&#x5B98;&#x65B9;&#x8BF4;&#x6CD5;&#xFF1A;&#x8FDE;&#x63A5;&#x6C60;&#x4E0D;&#x662F;&#x4E3A;&#x4E86;&#x63D0;&#x5347;&#x6027;&#x80FD;&#xFF0C;&#x662F;&#x4E3A;&#x4E86;&#x4FDD;&#x62A4;MySQL&#xFF0C;&#x7531;&#x4E8E;&#x591A;&#x4E86;&#x4E00;&#x6B21;&#x4EE3;&#x7406;&#x8F6C;&#x53D1;&#x5F53;&#x7136;&#x4F1A;&#x589E;&#x52A0;&#x4E00;&#x4E9B;&#x6D88;&#x8017;</p>
<p>&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;&#xFF1A;&#x5355;&#x673A;&#x6027;&#x80FD;&#x4F1A;&#x4E0B;&#x964D;&#xFF0C;&#x6709;&#x4E00;&#x5B9A;&#x7684;&#x5931;&#x8D25;&#x7387;&#xFF08;ab -c100 -t30 <a href="http://soa.t.izaodao.com/examples/mysql_proxy_client.php&#xFF09;" target="_blank" rel="external">http://soa.t.izaodao.com/examples/mysql_proxy_client.php&#xFF09;</a></p>
<p>&#x5907;&#x6CE8;&#xFF1A;&#x5982;&#x679C;&#x5F00;&#x542F;&#x670D;&#x52A1;&#x540E;&#xFF0C;&#x91CD;&#x542F;mysql&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FDE;&#x63A5;&#x6C60;&#x4F1A;&#x4E22;&#x5931;&#xFF0C;&#x4F46;&#x670D;&#x52A1;&#x4F9D;&#x65E7;&#x4F1A;&#x8FD0;&#x884C;&#xFF0C;&#x8FD9;&#x60C5;&#x51B5;&#x5927;&#x6982;&#x662F;&#x8FDE;&#x63A5;&#x6C60;&#x5931;&#x6548;&#x4E86;</p>
<p>&#x9047;&#x5230;&#x95EE;&#x9898;</p>
<p>PHP Fatal error:  Call to undefined function swoole_get_mysqli_sock()</p>
<p>&#x89E3;&#x51B3;&#x65B9;&#x5F0F;</p>
<p>./configure &#x2013;enable-async-mysql <a href="https://github.com/swoole/swoole-src/issues/51" target="_blank" rel="external">&#x95EE;&#x7B54;</a></p>
<p>&#x7B80;&#x5355;&#x5BA2;&#x6237;&#x7AEF;&#x7A0B;&#x5E8F;<code>mysql_proxy_client.php</code><br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">dbcp_query</span><span class="params">($sql)</span></span>{  </div><div class="line">    $link=<span class="keyword">new</span> swoole_client(SWOOLE_SOCK_TCP,SWOOLE_SOCK_SYNC);<span class="comment">//TCP&#x65B9;&#x5F0F;&#x3001;&#x540C;&#x6B65;  </span></div><div class="line">    $link-&gt;connect(<span class="string">&apos;127.0.0.1&apos;</span>,<span class="number">9509</span>);<span class="comment">//&#x8FDE;&#x63A5;  </span></div><div class="line">    $link-&gt;send($sql);<span class="comment">//&#x6267;&#x884C;&#x67E5;&#x8BE2;  </span></div><div class="line">    <span class="keyword">die</span>(var_dump($link-&gt;recv()));  </div><div class="line">    <span class="keyword">return</span> unserialize($link-&gt;recv()); <span class="comment">//&#x8FD9;&#x884C;&#x4F1A;&#x62A5;&#x9519;&#xFF0C;&#x6CE8;&#x91CA;&#x6389;&#x4E86;&#xFF1A;PHP Notice:  unserialize(): Error at offset 0 of 292 bytes in /data/htdocs/mysql.swoole.com/mysqlSwooleCli.php on line 6  </span></div><div class="line">    <span class="comment">//swoole_client&#x7C7B;&#x6790;&#x6784;&#x65F6;&#x4F1A;&#x81EA;&#x52A8;&#x5173;&#x95ED;&#x8FDE;&#x63A5;  </span></div><div class="line">}  </div><div class="line">$sql=<span class="string">&quot;SELECT * FROM `ask_category` limit 1&quot;</span>;  </div><div class="line">$dbRetArr = dbcp_query($sql);  </div><div class="line">var_dump($dbRetArr);</div></pre></td></tr></table></figure></p>
<p>&#x6267;&#x884C;&#x540E;&#x67E5;&#x8BE2;</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">MySQL [(none)]&gt; show processlist;</div><div class="line">+----+------+-------------------+-----------+---------+------+-------+------------------+</div><div class="line">| Id | User | Host              | db        | Command | Time | State | Info             |</div><div class="line">+----+------+-------------------+-----------+---------+------+-------+------------------+</div><div class="line">|  <span class="number">2</span> | root | <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">19528</span>   | swoolecms | Sleep   | <span class="number">2105</span> |       | <span class="keyword">NULL</span>             |</div><div class="line">|  <span class="number">3</span> | root | <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">19529</span>   | swoolecms | Sleep   | <span class="number">2105</span> |       | <span class="keyword">NULL</span>             |</div><div class="line">|  <span class="number">4</span> | root | <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">19530</span>   | swoolecms | Sleep   | <span class="number">2105</span> |       | <span class="keyword">NULL</span>             |</div><div class="line">|  <span class="number">5</span> | root | <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">19531</span>   | swoolecms | Sleep   | <span class="number">2105</span> |       | <span class="keyword">NULL</span>             |</div><div class="line">|  <span class="number">6</span> | root | <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">19532</span>   | swoolecms | Sleep   | <span class="number">2105</span> |       | <span class="keyword">NULL</span>             |</div><div class="line">|  <span class="number">7</span> | root | <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">19533</span>   | swoolecms | Sleep   | <span class="number">2105</span> |       | <span class="keyword">NULL</span>             |</div><div class="line">|  <span class="number">8</span> | root | <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">19534</span>   | swoolecms | Sleep   | <span class="number">2105</span> |       | <span class="keyword">NULL</span>             |</div><div class="line">|  <span class="number">9</span> | root | <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">19535</span>   | swoolecms | Sleep   | <span class="number">2105</span> |       | <span class="keyword">NULL</span>             |</div><div class="line">| <span class="number">10</span> | root | <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">19536</span>   | swoolecms | Sleep   | <span class="number">2105</span> |       | <span class="keyword">NULL</span>             |</div><div class="line">| <span class="number">11</span> | root | <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">19537</span>   | swoolecms | Sleep   | <span class="number">2105</span> |       | <span class="keyword">NULL</span>             |</div><div class="line">| <span class="number">12</span> | root | <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">19538</span>   | swoolecms | Sleep   | <span class="number">2105</span> |       | <span class="keyword">NULL</span>             |</div><div class="line">| <span class="number">13</span> | root | <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">19539</span>   | swoolecms | Sleep   | <span class="number">2105</span> |       | <span class="keyword">NULL</span>             |</div><div class="line">| <span class="number">14</span> | root | <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">19540</span>   | swoolecms | Sleep   | <span class="number">2105</span> |       | <span class="keyword">NULL</span>             |</div><div class="line">| <span class="number">15</span> | root | <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">19541</span>   | swoolecms | Sleep   | <span class="number">2105</span> |       | <span class="keyword">NULL</span>             |</div><div class="line">| <span class="number">16</span> | root | <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">19542</span>   | swoolecms | Sleep   | <span class="number">2105</span> |       | <span class="keyword">NULL</span>             |</div><div class="line">| <span class="number">17</span> | root | <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">19543</span>   | swoolecms | Sleep   | <span class="number">2105</span> |       | <span class="keyword">NULL</span>             |</div><div class="line">| <span class="number">18</span> | root | <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">19544</span>   | swoolecms | Sleep   | <span class="number">2105</span> |       | <span class="keyword">NULL</span>             |</div><div class="line">| <span class="number">19</span> | root | <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">19545</span>   | swoolecms | Sleep   | <span class="number">2105</span> |       | <span class="keyword">NULL</span>             |</div><div class="line">| <span class="number">20</span> | root | <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">19546</span>   | swoolecms | Sleep   | <span class="number">2105</span> |       | <span class="keyword">NULL</span>             |</div><div class="line">| <span class="number">21</span> | root | <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">19547</span>   | swoolecms | Sleep   |   <span class="number">92</span> |       | <span class="keyword">NULL</span>             |</div><div class="line">| <span class="number">22</span> | neco | <span class="number">1.13</span><span class="number">.239</span><span class="number">.20</span>:<span class="number">64309</span> | swoolecms | Sleep   |  <span class="number">232</span> |       | <span class="keyword">NULL</span>             |</div><div class="line">| <span class="number">23</span> | neco | <span class="number">1.13</span><span class="number">.239</span><span class="number">.20</span>:<span class="number">64310</span> | swoolecms | Sleep   |  <span class="number">232</span> |       | <span class="keyword">NULL</span>             |</div><div class="line">| <span class="number">24</span> | root | localhost         | <span class="keyword">NULL</span>      | Query   |    <span class="number">0</span> | init  | show processlist |</div><div class="line">+----+------+-------------------+-----------+---------+------+-------+------------------+</div><div class="line"><span class="number">23</span> rows in set (<span class="number">0.00</span> sec)</div></pre></td></tr></table></figure>
<p>&#x5BF9;&#x6BD4;&#x6D4B;&#x8BD5;&#x7528;&#x7A0B;&#x5E8F;</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//&#x521B;&#x5EFA;&#x5BF9;&#x8C61;&#x5E76;&#x6253;&#x5F00;&#x8FDE;&#x63A5;&#xFF0C;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x9009;&#x62E9;&#x7684;&#x6570;&#x636E;&#x5E93;&#x540D;&#x79F0;</span></div><div class="line">$mysqli = <span class="keyword">new</span> mysqli(<span class="string">&apos;localhost&apos;</span>,<span class="string">&apos;root&apos;</span>,<span class="string">&apos;123456&apos;</span>,<span class="string">&apos;swoolecms&apos;</span>);</div><div class="line"><span class="comment">//Output any connection error</span></div><div class="line"><span class="keyword">if</span> ($mysqli-&gt;connect_error) {</div><div class="line">    <span class="keyword">die</span>(<span class="string">&apos;Error : (&apos;</span>. $mysqli-&gt;connect_errno .<span class="string">&apos;) &apos;</span>. $mysqli-&gt;connect_error);</div><div class="line">}</div><div class="line">$sql=<span class="string">&quot;SELECT * FROM `ask_category` limit 1&quot;</span>;  </div><div class="line"><span class="keyword">echo</span> <span class="number">123</span>;</div><div class="line">$results = $mysqli-&gt;query($sql);</div><div class="line"><span class="keyword">while</span>($row = $results-&gt;fetch_array()) {</div><div class="line">var_dump($row);</div><div class="line">}   </div><div class="line"><span class="comment">// Frees the memory associated with a result</span></div><div class="line">$results-&gt;free();</div><div class="line"><span class="comment">// close connection </span></div><div class="line">$mysqli-&gt;close();</div></pre></td></tr></table></figure>
<h3 id="18-multi-port-server-php-&#x591A;&#x8FDE;&#x63A5;&#x540C;&#x65F6;&#x670D;&#x52A1;"><a href="#18-multi-port-server-php-&#x591A;&#x8FDE;&#x63A5;&#x540C;&#x65F6;&#x670D;&#x52A1;" class="headerlink" title="18.multi_port_server.php &#x591A;&#x8FDE;&#x63A5;&#x540C;&#x65F6;&#x670D;&#x52A1;"></a>18.<code>multi_port_server.php</code> &#x591A;&#x8FDE;&#x63A5;&#x540C;&#x65F6;&#x670D;&#x52A1;</h3><p>&#x63A5;&#x6536;&#x5230;&#x4FE1;&#x606F;&#x540E;&#xFF0C;&#x5982;&#x679C;&#x662F;9502&#x7AEF;&#x53E3;&#x7684;udp&#x8FDE;&#x63A5;&#xFF0C;&#x5FAA;&#x73AF;&#x83B7;&#x5F97;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x7684;id&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x5B58;&#x5728;&#x5219;&#x9000;&#x51FA;&#xFF08;&#x591A;&#x7528;&#x6237;&#x6A21;&#x5F0F;&#x4E0B;&#x5904;&#x7406;&#xFF09;</p>
<p>&#x5982;&#x679C;&#x53BB;&#x6389;while&#x5219;&#x5176;&#x4ED6;&#x8FDE;&#x63A5;&#x4F1A;&#x63D0;&#x793A;swoole_client::recv(): recv() failed. Error: Resource temporarily unavailable</p>
<p>&#x5BA2;&#x6237;&#x7AEF;&#x4F7F;&#x7528;&#x7684;&#x662F;client/udp_sync.php</p>
<h3 id="19-client2-php-&#x963B;&#x585E;&#x8FDE;&#x63A5;&#xFF0C;&#x6BCF;&#x79D2;&#x53D1;&#x9001;&#x4FE1;&#x606F;&#x5230;&#x670D;&#x52A1;"><a href="#19-client2-php-&#x963B;&#x585E;&#x8FDE;&#x63A5;&#xFF0C;&#x6BCF;&#x79D2;&#x53D1;&#x9001;&#x4FE1;&#x606F;&#x5230;&#x670D;&#x52A1;" class="headerlink" title="19.client2.php &#x963B;&#x585E;&#x8FDE;&#x63A5;&#xFF0C;&#x6BCF;&#x79D2;&#x53D1;&#x9001;&#x4FE1;&#x606F;&#x5230;&#x670D;&#x52A1;"></a>19.<code>client2.php</code> &#x963B;&#x585E;&#x8FDE;&#x63A5;&#xFF0C;&#x6BCF;&#x79D2;&#x53D1;&#x9001;&#x4FE1;&#x606F;&#x5230;&#x670D;&#x52A1;</h3><h3 id="20-c10k-php-&#x6700;&#x9AD8;10k&#x957F;&#x8FDE;&#x63A5;"><a href="#20-c10k-php-&#x6700;&#x9AD8;10k&#x957F;&#x8FDE;&#x63A5;" class="headerlink" title="20.c10k.php &#x6700;&#x9AD8;10k&#x957F;&#x8FDE;&#x63A5;"></a>20.<code>c10k.php</code> &#x6700;&#x9AD8;10k&#x957F;&#x8FDE;&#x63A5;</h3><p>&#x7ECF;&#x6D4B;&#x8BD5;&#xFF0C;&#x80FD;&#x4FDD;&#x6301;&#x7684;&#x8FDE;&#x63A5;&#x6570;&#x548C;&#x914D;&#x7F6E;&#x6709;&#x5173;&#xFF0C;1&#x6838;2g&#x5185;&#x5B58;&#x5927;&#x6982;1k</p>
<h3 id="21-buffer-php-&#x5185;&#x5B58;&#x6570;&#x636E;&#x64CD;&#x4F5C;"><a href="#21-buffer-php-&#x5185;&#x5B58;&#x6570;&#x636E;&#x64CD;&#x4F5C;" class="headerlink" title="21.buffer.php &#x5185;&#x5B58;&#x6570;&#x636E;&#x64CD;&#x4F5C;"></a>21.<code>buffer.php</code> &#x5185;&#x5B58;&#x6570;&#x636E;&#x64CD;&#x4F5C;</h3><h3 id="22-websocket"><a href="#22-websocket" class="headerlink" title="22.websocket"></a>22.<code>websocket</code></h3><p>1.client.html&#x53EA;&#x662F;&#x7B80;&#x5355;demo</p>
<p>2.client.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&#x62A5;&#x9519;&#xFF1A;<span class="keyword">echo</span> <span class="string">&quot;Error: {$this-&gt;socket-&gt;errMsg}&quot;</span>;</div><div class="line">errMsg&#x5C5E;&#x6027;&#x6CA1;&#x6709;&#x627E;&#x5230;&#xFF0C;&#x7528;errCode&#x66FF;&#x6362;</div></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&#x62A5;&#x9519;&#xFF1A;swoole_client::recv(): recv() failed. Error: Resource temporarily unavailable</div><div class="line">&#x8BE5;&#x9519;&#x8BEF;&#x662F;&#x7531;&#x4E8E;&#x63A5;&#x6536;&#x6CA1;&#x6709;&#x6B63;&#x5E38;&#x9000;&#x51FA;&#x5F15;&#x8D77;</div></pre></td></tr></table></figure>
<p>3.server.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#x62A5;&#x9519;&#xFF1A;swoole_websocket_server::push(): connection[<span class="number">1</span>] is not a websocket client.</div><div class="line">$_server-&gt;tick&#x7684;&#x65F6;&#x5019;&#x7531;&#x4E8E;&#x5BA2;&#x6237;&#x7AEF;&#x5DF2;&#x7ECF;&#x5173;&#x95ED;&#xFF0C;&#x6240;&#x4EE5;&#x53D1;&#x9001;&#x5931;&#x8D25;</div><div class="line">&#x8FD9;&#x65F6;&#x5019;&#x9700;&#x8981;&#x5FAA;&#x73AF;&#x6267;&#x884C;client.php&#x4E2D;&#x7684;recv()</div></pre></td></tr></table></figure>
<p>&#x5C0F;&#x7ED3;&#xFF1A;</p>
<p>tcp&#x901A;&#x4FE1;&#x7684;&#x6837;&#x4F8B;&#xFF0C;&#x4E3E;&#x4F8B;&#x4E86;&#x7B80;&#x5355;&#x7684;&#x4E00;&#x6B21;&#x6027;&#x901A;&#x4FE1;&#xFF0C;&#x8FD8;&#x6709;&#x670D;&#x52A1;&#x7AEF;&#x901A;&#x8FC7;tick&#x65B9;&#x5F0F;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x901A;&#x8FC7;&#x5FAA;&#x73AF;&#x63A5;&#x6536;&#xFF0C;&#x5B9E;&#x73B0;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x7AEF;&#x957F;&#x8FDE;&#x63A5;&#x901A;&#x4FE1;</p>
<h3 id="&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5C01;&#x88C5;&#x7684;websocketclient-php&#x4F7F;&#x7528;&#x4E86;token&#x8FDB;&#x884C;&#x4E86;&#x8BA4;&#x8BC1;&#x6536;&#x53D1;&#x6570;&#x636E;"><a href="#&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5C01;&#x88C5;&#x7684;websocketclient-php&#x4F7F;&#x7528;&#x4E86;token&#x8FDB;&#x884C;&#x4E86;&#x8BA4;&#x8BC1;&#x6536;&#x53D1;&#x6570;&#x636E;" class="headerlink" title="&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5C01;&#x88C5;&#x7684;websocketclient.php&#x4F7F;&#x7528;&#x4E86;token&#x8FDB;&#x884C;&#x4E86;&#x8BA4;&#x8BC1;&#x6536;&#x53D1;&#x6570;&#x636E;"></a>&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5C01;&#x88C5;&#x7684;websocketclient.php&#x4F7F;&#x7528;&#x4E86;token&#x8FDB;&#x884C;&#x4E86;&#x8BA4;&#x8BC1;&#x6536;&#x53D1;&#x6570;&#x636E;</h3><h3 id="23-unixsock"><a href="#23-unixsock" class="headerlink" title="23.unixsock"></a>23.<code>unixsock</code></h3><p>stream_server.php &#x548C; stream_client.php &#x4F7F;&#x7528;SWOOLE_SOCK_UNIX_STREAM&#x65B9;&#x5F0F;&#x7684;&#x7B80;&#x5355;&#x901A;&#x4FE1;&#x6837;&#x4F8B;&#xFF0C;SWOOLE_SOCK_UNIX_STREAM&#x5BF9;&#x5E94;&#x7684;&#x7F16;&#x53F7;&#x4E3A;6</p>
<p>SOCK_DGRAM &#x662F;&#x65E0;&#x4FDD;&#x969C;&#x7684;&#x9762;&#x5411;&#x6D88;&#x606F;&#x7684;socket&#xFF0C;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x5728;&#x7F51;&#x7EDC;&#x4E0A;&#x53D1;&#x5E7F;&#x64AD;&#x4FE1;&#x606F;&#x3002;</p>
<p>dgram_server.php &#x548C; dgram_client.php &#x4F7F;&#x7528; SOCK_DGRAM &#x65B9;&#x5F0F;&#x901A;&#x4FE1;&#xFF0C;&#x4F7F;&#x7528; onPacket &#x63A5;&#x6536; UDP &#x6570;&#x636E;</p>
<p>async_client.php &#x5F02;&#x6B65; SWOOLE_SOCK_UNIX_STREAM &#x5BA2;&#x6237;&#x7AEF;&#x6837;&#x4F8B;&#xFF0C;&#x63A5;&#x6536;&#x4FE1;&#x606F;&#x540E;&#x518D;&#x53D1;&#x9001;&#x4FE1;&#x606F;&#x5FAA;&#x73AF;&#x901A;&#x4FE1;&#xFF0C;&#x53D6;&#x6D88;&#x53D1;&#x9001;&#x540E;&#x5BA2;&#x6237;&#x7AEF;&#x4E0D;&#x9000;&#x51FA;</p>
<p>swoole_event_wait &#x4E8B;&#x4EF6;&#x8F6E;&#x8BE2;<code>&#x6CE8;&#x91CA;&#x6389;&#x540E;&#xFF0C;&#x4EE3;&#x7801;&#x4F1A;&#x7EE7;&#x7EED;&#x6267;&#x884C;</code></p>
<h3 id="24-udp-&#x7B80;&#x5355;&#x7684;udp&#x6837;&#x4F8B;"><a href="#24-udp-&#x7B80;&#x5355;&#x7684;udp&#x6837;&#x4F8B;" class="headerlink" title="24.udp &#x7B80;&#x5355;&#x7684;udp&#x6837;&#x4F8B;"></a>24.<code>udp</code> &#x7B80;&#x5355;&#x7684;udp&#x6837;&#x4F8B;</h3><h3 id="25-timer-&#x7B80;&#x5355;&#x5B9A;&#x65F6;&#x5668;"><a href="#25-timer-&#x7B80;&#x5355;&#x5B9A;&#x65F6;&#x5668;" class="headerlink" title="25.timer &#x7B80;&#x5355;&#x5B9A;&#x65F6;&#x5668;"></a>25.<code>timer</code> &#x7B80;&#x5355;&#x5B9A;&#x65F6;&#x5668;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">swoole_process::signal(SIGTERM, function() {//&#x8BBE;&#x7F6E;&#x5F02;&#x6B65;&#x4FE1;&#x53F7;&#x76D1;&#x542C;&#x3002;</div><div class="line">    swoole_event_exit();//&#x9000;&#x51FA;&#x4E8B;&#x4EF6;&#x8F6E;&#x8BE2;&#xFF0C;&#x6B64;&#x51FD;&#x6570;&#x4EC5;&#x5728;Client&#x7A0B;&#x5E8F;&#x4E2D;&#x6709;&#x6548;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x4F7F;&#x7528;&#xFF0C;&#x5219;&#x7A0B;&#x5E8F;&#x4F1A;&#x4E00;&#x76F4;&#x7B49;&#x5F85;</div><div class="line">});</div><div class="line">//&#x7531;&#x4E8E;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x95EE;&#x9898;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x4EE5;&#x524D;&#x7C7B;&#x4F3C;&#x9519;&#x8BEF;Class &apos;App\Controller\swoole_process&apos; not found in</div><div class="line">//&#x89E3;&#x51B3;&#x65B9;&#x5F0F;&#x53EF;&#x4EE5;&#x5728;&#x8C03;&#x7528;&#x524D;&#x52A0;\&#xFF0C;&#x5982; \swoole_process</div></pre></td></tr></table></figure>
<h3 id="26-task-&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x6837;&#x4F8B;"><a href="#26-task-&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x6837;&#x4F8B;" class="headerlink" title="26.task &#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x6837;&#x4F8B;"></a>26.<code>task</code> &#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x6837;&#x4F8B;</h3><p>1.shared_client.php &#x548C; shared_server.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">php shared_client.php set aaa 111</div><div class="line">&#x8F93;&#x51FA;&#xFF1A;ok</div><div class="line">php shared_client.php get aaa</div><div class="line">&#x8F93;&#x51FA;&#xFF1A;get aaa: 111_0&#xFF08;&#x5B58;&#x50A8;&#x7684;&#x65F6;&#x5019;$val = $data[&apos;val&apos;].&quot;_&quot;.$from_id;&#xFF09;</div></pre></td></tr></table></figure>
<p>shared_server.php &#x63A5;&#x6536;&#x4FE1;&#x606F;&#x540E;&#xFF0C;&#x6295;&#x9012;task&#x5B8C;&#x6210;</p>
<p>2.task.php &#x540C;&#x6B65;&#x4EFB;&#x52A1;&#x548C;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x6837;&#x4F8B;</p>
<p>3.task_num.php &#x5B9A;&#x65F6;&#x7EDF;&#x8BA1;TCP&#x8FDE;&#x63A5;&#x6570;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$serv-&gt;addtimer(5000);//&#x8BE5;&#x65B9;&#x6CD5;&#x88AB;tick&#x53D6;&#x4EE3;&#xFF0C;&#x8BBE;&#x7F6E;&#x89E6;&#x53D1;&#x65F6;&#x95F4;</div><div class="line">$serv-&gt;on(&apos;Timer&apos;, function(swoole_server $serv, $time) {</div><div class="line">    echo &quot;{$time} call&quot;.PHP_EOL;</div><div class="line">    print_r($serv-&gt;stats());//&#x5F97;&#x5230;&#x5F53;&#x524D;Server&#x7684;&#x6D3B;&#x52A8;TCP&#x8FDE;&#x63A5;&#x6570;&#xFF0C;&#x542F;&#x52A8;&#x65F6;&#x95F4;&#xFF0C;accpet/close&#x7684;&#x603B;&#x6B21;&#x6570;&#x7B49;&#x4FE1;&#x606F;&#x3002;</div><div class="line">});</div></pre></td></tr></table></figure>
<h3 id="27-table-&#x5185;&#x5B58;&#x8868;"><a href="#27-table-&#x5185;&#x5B58;&#x8868;" class="headerlink" title="27.table &#x5185;&#x5B58;&#x8868;"></a>27.<code>table</code> &#x5185;&#x5B58;&#x8868;</h3><p>1.iterator.php &#x64CD;&#x4F5C;&#x5185;&#x5B58;&#x8868;&#x6837;&#x4F8B;</p>
<p>2.server.php &#x670D;&#x52A1;&#x7ED3;&#x5408;&#x5185;&#x5B58;&#x8868;&#x6837;&#x4F8B;</p>
<p>3.set.php &#x64CD;&#x4F5C;&#x5185;&#x5B58;&#x8868;&#x6837;&#x4F8B;,&#x548C;iterator.php&#x6CA1;&#x4EC0;&#x4E48;&#x533A;&#x522B;</p>
<p>4.simulation.php &#x6027;&#x80FD;&#x6D4B;&#x8BD5;&#x6837;&#x4F8B;</p>
<p>$table-&gt;set($i, [&#x2018;id&#x2019; =&gt; $i, &#x2018;name&#x2019; =&gt; $i, &#x2018;num&#x2019; =&gt; $i]);//&#x540E;&#x9762;&#x6570;&#x7EC4;&#x7684;&#x65B0;&#x5199;&#x6CD5;&#xFF1F;</p>
<h3 id="28-ssl"><a href="#28-ssl" class="headerlink" title="28.ssl"></a>28.<code>ssl</code></h3><p>1.websocket_server.php</p>
<p>&#x62A5;&#x9519;&#xFF1A;PHP Notice:  Use of undefined constant SWOOLE_SSL - assumed &#x2018;SWOOLE_SSL&#x2019; in /newdata/www/soa-swoole/examples/ssl/websocket_server.php on line 3</p>
<p>&#x4F7F;&#x7528;SSL&#x91CD;&#x65B0;&#x7F16;&#x8BD1; ./configure -enable-async-mysql -enable-openssl</p>
<p>&#x91CD;&#x65B0;&#x6267;&#x884C;&#x62A5;&#x9519;&#xFF1A;PHP Fatal error:  swoole_server_port::set(): ssl cert file[/ssl.crt] not found. in /newdata/www/soa-swoole/examples/ssl/websocket_server.php on line 9</p>
<p>$ssl_dir = realpath(&#x2018;../../tests/ssl&#x2019;);&#x8FD4;&#x56DE;false,&#x6CA1;&#x6709;&#x627E;&#x5230;&#x5730;&#x5740;&#xFF0C;&#x8C03;&#x6574;&#x540E;&#x8FD0;&#x884C;&#x6B63;&#x5E38;</p>
<p>2.&#x8FD0;&#x884C; stream_client.php &#x548C; websocket_client.html &#x5747;&#x4E0D;&#x80FD;&#x8FDE;&#x63A5;&#xFF0C;&#x539F;&#x56E0;&#x672A;&#x77E5;</p>
<p>&#x5176;&#x4ED6;&#x4E24;&#x5929;&#x6837;&#x4F8B;&#x4E5F;&#x662F;&#xFF0C;&#x7A76;&#x5176;&#x539F;&#x56E0;&#x5C31;&#x662F;&#x8FDE;&#x4E0D;&#x4E0A;&#x670D;&#x52A1;&#x5668;</p>
<p>&#x5C1D;&#x8BD5;&#x66F4;&#x6362;ssl&#x8BA4;&#x8BC1;&#x6587;&#x4EF6;&#xFF0C;&#x90FD;&#x7528;&#x4E0D;&#x4E86;&#x62A5;&#x9519;&#xFF0C;&#x516C;&#x94A5;&#x548C;&#x79C1;&#x94A5;&#x5319;&#x4E0D;&#x5339;&#x914D;</p>
<p>websocket_client.html &#x5982;&#x679C;&#x4F7F;&#x7528;wss&#x65B9;&#x5F0F;&#xFF0C;&#x4F1A;&#x63D0;&#x793A; failed: WebSocket opening handshake was canceled</p>
<p>&#x4F7F;&#x7528;ws&#x65B9;&#x5F0F;&#xFF0C;&#x670D;&#x52A1;&#x7AEF;&#x4F1A;&#x63D0;&#x793A;    WARNING    swSSL_accept: bad SSL client</p>
<p>&#x91CD;&#x65B0;&#x914D;&#x7F6E;&#x8BC1;&#x4E66;&#x540E;&#xFF0C;websocket_server.php &#x5BF9;&#x5E94; websocket_client.html &#x6D4B;&#x8BD5;&#x901A;&#x8FC7;&#xFF0C;&#x8BC1;&#x4E66;&#x914D;&#x7F6E;&#x53C2;&#x8003;&#x4E0B;&#x9762;</p>
<h3 id="&#x5BC6;&#x94A5;&#x751F;&#x6210;&#x53C2;&#x8003;"><a href="#&#x5BC6;&#x94A5;&#x751F;&#x6210;&#x53C2;&#x8003;" class="headerlink" title="&#x5BC6;&#x94A5;&#x751F;&#x6210;&#x53C2;&#x8003;"></a>&#x5BC6;&#x94A5;&#x751F;&#x6210;<a href="/blog/2016/05/01/https-nginx-openssl">&#x53C2;&#x8003;</a></h3><h3 id="28-server"><a href="#28-server" class="headerlink" title="28.server"></a>28.<code>server</code></h3><p>1.echo.php &#x7B80;&#x5355;swoole_serverr&#x6837;&#x4F8B;</p>
<p>2.exist.php &#x57FA;&#x672C;swoole_ser&#x6837;&#x4F8B;</p>
<p>3.fixed_header_server.php &#x548C; fixed_header_client.php</p>
<p>&#x672C;&#x4F8B;&#x4E3B;&#x8981;&#x662F;&#x548C;&#x6570;&#x636E;&#x5305;&#x6709;&#x5173;&#xFF0C;&#x4F7F;&#x7528;pack&#x548C;unpack&#x65B9;&#x5F0F;&#x6536;&#x53D1;&#x4FE1;&#x606F;&#xFF0C;&#x4E0D;&#x8FC7;&#x6837;&#x4F8B;&#x6A21;&#x5F0F;&#x6709;&#x95EE;&#x9898;&#xFF0C;&#x4E3B;&#x8981;&#x95EE;&#x9898;&#x5728;do while &#x5FAA;&#x73AF;&#x5BF9;&#x6570;&#x636E;&#x5904;&#x7406;&#x4E0A;&#xFF0C;&#x4F7F;&#x7528;frame_client.php&#x8FDB;&#x884C;&#x8FDE;&#x63A5;&#x4F1A;&#x663E;&#x793A;&#x5177;&#x4F53;&#x9519;&#x8BEF;</p>
<p>fixed_header_server1.7.3.php</p>
<p>&#x6837;&#x4F8B;&#x8C8C;&#x4F3C;&#x65E7;&#x7248;&#xFF0C;&#x7ECF;&#x6D4B;&#x8BD5;&#x95EE;&#x9898;&#x66F4;&#x591A;</p>
<p>4.frame_client.php &#x6253;&#x5305;&#x53D1;&#x9001;&#x4FE1;&#x606F;&#x6837;&#x4F8B;</p>
<p>5.ip_dispatch.php &#x53EA;&#x662F;&#x4F7F;&#x7528;&#x4E86;dispatch_mode&#x6A21;&#x5F0F;&#x800C;&#x5DF2;</p>
<p>6.local_listener.php </p>
<p>&#x4F7F;&#x7528;stream_socket_server&#x5EFA;&#x7ACB;&#x670D;&#x52A1;&#xFF0C;&#x5E76;&#x653E;&#x5165;&#x7BA1;&#x9053;&#x4E2D;&#xFF0C;&#x8FD9;&#x79CD;&#x505A;&#x6CD5;&#x5927;&#x6982;&#x5C31;&#x662F;&#x5F02;&#x6B65;&#x7684;&#x4F7F;&#x7528;php&#x7CFB;&#x7EDF;&#x7684;socket&#x670D;&#x52A1;</p>
<p>7.msgqueue.php</p>
<p>$serv-&gt;addtimer(1000);&#x4E0E;onTimer &#x5DF2;&#x88AB;&#x53D6;&#x6D88;&#xFF0C;&#x6D88;&#x606F;&#x961F;&#x5217;&#x4F5C;&#x7528;&#x672A;&#x77E5;</p>
<p>8.pipe_message.php</p>
<p>OnPipeMessage &#x548C; OnMessage &#xFF0C;&#x4E00;&#x4E2A;&#x662F;swoole_server&#x65B9;&#x6CD5;&#xFF0C;&#x53E6;&#x4E00;&#x4E2A;&#x662F;&#x5B50;&#x7C7B;&#xFF08;&#x5982;swoole_websocket_server&#xFF09;&#x65B9;&#x6CD5;</p>
<p>&#x53EA;&#x662F;&#x4E2A;&#x7B80;&#x5355;&#x7684;task&#x548C;onPipMessage&#x7684;&#x6837;&#x4F8B;</p>
<p>9.single.php    &#x5355;&#x8FDB;&#x7A0B;&#x5355;&#x7EBF;&#x7A0B;&#x670D;&#x52A1;</p>
<p>10.receive.php &#x4F7F;&#x7528;uid&#x7ED1;&#x5B9A;&#x5BA2;&#x6237;&#x7AEF;&#x5BF9;&#x5E94;&#x7684;worker&#x8FDB;&#x7A0B;</p>
<p>&#x540C;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x53EA;&#x80FD;&#x88AB;bind&#x4E00;&#x6B21;&#xFF0C;&#x5982;&#x679C;&#x5DF2;&#x7ECF;&#x7ED1;&#x5B9A;&#x4E86;uid&#xFF0C;&#x518D;&#x6B21;&#x8C03;&#x7528;bind&#x4F1A;&#x8FD4;&#x56DE;false</p>
<p>&#x53EF;&#x4EE5;&#x4F7F;&#x7528;$serv-&gt;connection_info($fd) &#x67E5;&#x770B;&#x8FDE;&#x63A5;&#x6240;&#x7ED1;&#x5B9A;uid&#x7684;&#x503C; </p>
<p>11.unix_stream.php &#x4F7F;&#x7528;SWOOLE_UNIX_STREAM&#x7C7B;&#x578B;</p>
<p>12.zmq.php</p>
<p>&#x4F7F;&#x7528;zmq&#x961F;&#x5217;&#xFF0C;&#x9700;&#x8981;&#x5B89;&#x88C5;zmq&#x6269;&#x5C55;<a href="http://pecl.php.net/package/zmq" target="_blank" rel="external">&#x5730;&#x5740;</a>&#x548C;zmq(zeromq)&#x670D;&#x52A1;</p>
<p>&#x5B89;&#x88C5;&#x63D0;&#x793A; Unable to find libzmq &#x6267;&#x884C; apt-get install libzmq-dev </p>
<p>onWorkerStart &#x4F7F;&#x7528;&#x7BA1;&#x9053;&#x76D1;&#x542C;&#xFF0C;&#x6267;&#x884C;&#x4FE1;&#x606F;&#x4E0D;&#x4F1A;&#x663E;&#x793A;</p>
<p>&#x672C;&#x5730;&#x6837;&#x4F8B;&#x6709;&#x4E9B;&#x95EE;&#x9898;&#xFF0C;&#x53EF;&#x4EE5;&#x53C2;&#x770B;<a href="https://vpsboard.com/topic/4001-install-and-run-zeromq/" target="_blank" rel="external">&#x6837;&#x4F8B;</a></p>
<h3 id="29-redis"><a href="#29-redis" class="headerlink" title="29.redis"></a>29.<code>redis</code></h3><p>&#x63D0;&#x793A; swoole_redis &#x627E;&#x4E0D;&#x5230;</p>
<h3 id="30-process"><a href="#30-process" class="headerlink" title="30.process"></a>30.<code>process</code></h3><p>1.async_master.php </p>
<p>&#x5F02;&#x6B65;&#x8FDB;&#x7A0B;&#x6837;&#x4F8B;&#xFF0C;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x4F7F;&#x7528;</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//&#x5C06;&#x5B50;&#x8FDB;&#x7A0B;&#x7684;&#x7BA1;&#x9053;&#x52A0;&#x5165;EventLoop</span></div><div class="line"><span class="keyword">foreach</span>($workers <span class="keyword">as</span> $process)</div><div class="line">{</div><div class="line">    swoole_event_add($process-&gt;pipe, <span class="string">&apos;onReceive&apos;</span>);</div><div class="line">}</div></pre></td></tr></table></figure>
<p>&#x5982;&#x679C;&#x4E0A;&#x8FF0;&#x4EE3;&#x7801;&#x6CE8;&#x91CA;&#x6389;&#xFF0C;&#x8FDB;&#x7A0B;&#x4F1A;&#x963B;&#x585E;&#x6267;&#x884C;,&#x5982;&#x679C;&#x542F;&#x52A8;3&#x4E2A;&#x8FDB;&#x7A0B;&#x7684;&#x8BDD;&#xFF0C;&#x5FAA;&#x73AF;&#x963B;&#x585E;&#x6267;&#x884C;&#x8FDB;&#x7A0B;0&#xFF0C;1&#xFF0C;2</p>
<p>&#x53E6;&#x5916;&#xFF0C;&#x5982;&#x679C;&#x5728;eventloop&#x4E0A;&#x4F7F;&#x7528;sleep&#x6682;&#x505C;&#x51E0;&#x79D2;&#xFF0C;&#x6267;&#x884C;&#x7684;&#x8868;&#x73B0;&#x4E3A;&#xFF0C;&#x6682;&#x505C;&#x4E4B;&#x524D;&#x963B;&#x585E;&#xFF0C;&#x4E4B;&#x540E;&#x5F02;&#x6B65;</p>
<p>2.exec.php</p>
<p>&#x6267;&#x884C;&#x4E00;&#x4E2A;&#x5916;&#x90E8;&#x7A0B;&#x5E8F;stdin_stdout.php &#x901A;&#x8FC7;&#x6807;&#x51C6;&#x8F93;&#x5165;&#x8F93;&#x51FA;&#x901A;&#x4FE1;</p>
<p>3.msgqueue.php</p>
<p>&#x4F7F;&#x7528;&#x961F;&#x5217;&#x8BFB;&#x5199;&#x6570;&#x636E;,&#x963B;&#x585E;&#x5F0F;&#x6267;&#x884C;&#x8FDB;&#x7A0B;&#xFF0C;&#x5171;&#x4EAB;&#x6A21;&#x5F0F;&#x4F7F;&#x7528;&#x961F;&#x5217;&#xFF08;$mode&#x901A;&#x4FE1;&#x6A21;&#x5F0F;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;2&#xFF0C;&#x8868;&#x793A;&#x4E89;&#x62A2;&#x6A21;&#x5F0F;&#xFF0C;&#x6240;&#x6709;&#x521B;&#x5EFA;&#x7684;&#x5B50;&#x8FDB;&#x7A0B;&#x90FD;&#x4F1A;&#x4ECE;&#x961F;&#x5217;&#x4E2D;&#x53D6;&#x6570;&#x636E;<br>&#xFF09;</p>
<p>4.python.php &#x6267;&#x884C;&#x4E00;&#x4E2A;&#x5916;&#x90E8;&#x7A0B;&#x5E8F;echo.py</p>
<p>5.test.php &#x4F7F;&#x5F53;&#x524D;&#x8FDB;&#x7A0B;&#x8131;&#x53D8;&#x4E3A;&#x4E00;&#x4E2A;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x3002;</p>
<p>6.worker.php &#x8FDB;&#x7A0B;&#x963B;&#x585E;&#x6A21;&#x5F0F;&#x548C;&#x5F02;&#x6B65;&#x6A21;&#x5F0F;&#x6837;&#x4F8B;</p>
<p>&#x5F02;&#x6B65;&#x6A21;&#x5F0F;&#x4E0B;&#xFF0C;&#x4E3B;&#x8FDB;&#x7A0B;&#x548C;&#x5B50;&#x8FDB;&#x7A0B;&#x901A;&#x4FE1;&#xFF0C;&#x90FD;&#x9700;&#x8981;swoole_event_add&#x6CE8;&#x518C;&#x76D1;&#x542C;</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//&#x76D1;&#x542C;&#x8FDB;&#x7A0B;&#x72B6;&#x6001;&#xFF0C;&#x5982;&#x679C;&#x7ED3;&#x675F;&#x518D;&#x751F;&#x6210;&#x65B0;&#x8FDB;&#x7A0B;&#x7EE7;&#x7EED;</span></div><div class="line">swoole_process::signal(SIGCHLD, <span class="function"><span class="keyword">function</span> <span class="params">($signo)</span> <span class="title">use</span> <span class="params">(&amp;$workers)</span> </span>{</div><div class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</div><div class="line">    {</div><div class="line">        $ret = swoole_process::wait(<span class="keyword">false</span>);</div><div class="line">        <span class="keyword">if</span> ($ret)</div><div class="line">        {</div><div class="line">            $pid = $ret[<span class="string">&apos;pid&apos;</span>];</div><div class="line">            $child_process = $workers[$pid];</div><div class="line">            <span class="comment">//unset($workers[$pid]);</span></div><div class="line">            <span class="keyword">echo</span> <span class="string">&quot;Worker Exit, kill_signal={$ret[&apos;signal&apos;]} PID=&quot;</span> . $pid . PHP_EOL;</div><div class="line">            $new_pid = $child_process-&gt;start();</div><div class="line">            $workers[$new_pid] = $child_process;</div><div class="line">            <span class="keyword">unset</span>($workers[$pid]);</div><div class="line">        }</div><div class="line">        <span class="keyword">else</span></div><div class="line">        {</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        }</div><div class="line">    }</div></pre></td></tr></table></figure>
<h3 id="31-php"><a href="#31-php" class="headerlink" title="31.php"></a>31.<code>php</code></h3><p>1.debug_server.php &#x4F7F;&#x7528;stream_socket_server&#x63A5;&#x6536;&#x4FE1;&#x606F;</p>
<p>2.error.php &#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#x8BED;&#x53E5;</p>
<p>3.inotify.php &#x76D1;&#x63A7;&#xFF08;&#x9700;&#x8981;&#x5B89;&#x88C5;&#x6269;&#x5C55; inotify &#xFF09;</p>
<p>4.msyql.php &#x4F7F;&#x7528;mysqli&#x81EA;&#x5E26;&#x65B9;&#x6CD5;&#xFF0C;&#x5F02;&#x6B65;&#x83B7;&#x5F97;&#x67E5;&#x8BE2;&#x7ED3;&#x679C;</p>
<p>5.socket_server.php &#x4F7F;&#x7528;php&#x63D0;&#x4F9B;&#x7684;socket&#x670D;&#x52A1;</p>
<ol>
<li>steam_server.php &#x548C; stream_client.php</li>
</ol>
<p>php&#x81EA;&#x5E26;&#x76D1;&#x542C;&#x6837;&#x4F8B; </p>
<h3 id="32-packet"><a href="#32-packet" class="headerlink" title="32.packet"></a>32.<code>packet</code></h3><p>1.async.php &#x7B80;&#x5355;swoole_client&#x5BA2;&#x6237;&#x7AEF;,&#x521D;&#x59CB;&#x5316;&#x4F7F;&#x7528;&#x4E86;SWOOLE_PACKET</p>
<p>2.ser.php &#x7B80;&#x5355;server&#xFF0C;&#x53C2;&#x6570;&#x4F7F;&#x7528;SWOOLE_PACKET</p>
<p>sync.php&#x548C;client_pack.php&#x7684;&#x533A;&#x522B;&#x5728;&#x4E8E;sync.php&#x76F4;&#x63A5;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4E8C;client_pack.php&#x53D1;&#x9001;&#x7684;&#x662F;&#x5305;&#x5904;&#x7406;&#x540E;&#x7684;&#x6570;&#x636E;</p>
<p>&#x5728;sync.php&#x8FDE;&#x63A5;&#x540E;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x8B66;&#x544A; WARNING    swProtocol_recv_check_length: package is too big</p>
<p>&#x539F;&#x56E0;&#x53EF;&#x80FD;&#x662F;&#x6CA1;&#x6709;&#x6309;&#x53D1;&#x5305;&#x683C;&#x5F0F;&#x53D1;&#x9001;&#x5427; <code>$msg_length = pack(&quot;N&quot;, strlen($msg_normal)) . $msg_normal;</code></p>
<h3 id="33-namespace"><a href="#33-namespace" class="headerlink" title="33.namespace"></a>33.<code>namespace</code></h3><p>Enable Namespace Class</p>
<p>modify your <code>php.ini</code> file.</p>
<p>swoole.use_namespace = on</p>
<p>1.atomic.php &#x539F;&#x5B50;&#x8BA1;&#x6570;&#x64CD;&#x4F5C;&#x7C7B;</p>
<p>&#x5176;&#x4ED6;&#x6837;&#x4F8B;&#x90FD;&#x5F88;&#x7B80;&#x5355;</p>
<h3 id="33-mysql"><a href="#33-mysql" class="headerlink" title="33.mysql"></a>33.<code>mysql</code></h3><p>1.async_mysql2.php</p>
<p>&#x5F02;&#x6B65;&#x6267;&#x884C;mysql&#x67E5;&#x8BE2;&#xFF0C;&#x5148;&#x8F93;&#x51FA;Finish&#xFF0C;&#x7B49;&#x6267;&#x884C;&#x7ED3;&#x675F;&#x540E;&#x8F93;&#x51FA;&#x67E5;&#x8BE2;&#x7ED3;&#x679C;&#xFF0C;&#x5BF9;&#x4E8E;swoole_event_add&#x7684;&#x4F7F;&#x7528;&#x53EF;&#x4EE5;&#x53C2;&#x8003;</p>
<p>2.concurrent.php &#x5F02;&#x6B65;Mysql</p>
<p>&#x521B;&#x5EFA;20&#x4E2A;Mysqli&#x5B9E;&#x4F8B;&#xFF0C;&#x4F7F;&#x7528;swoole_mysql_query&#x8C03;&#x7528;&#x6267;&#x884C;&#xFF0C;&#x4E0D;&#x8FC7;mysql&#x662F;&#x5F02;&#x6B65;&#x7684;&#xFF0C;&#x4F46;&#x6267;&#x884C;&#x7ED3;&#x679C;&#x662F;&#x963B;&#x585E;&#x7684;&#xFF0C;&#x5927;&#x6982;&#x662F;&#x56E0;&#x4E3A;swoole_mysql_query&#x4F7F;&#x7528;&#x7684;&#x961F;&#x5217;&#x65B9;&#x5F0F;&#xFF0C;&#x5148;&#x8FDB;&#x5148;&#x51FA;</p>
<p>3.real_async.php</p>
<p>&#x7B80;&#x5355;&#x6837;&#x4F8B;&#xFF0C;&#x4F7F;&#x7528;&#x4E86;2&#x79CD;&#x5F02;&#x6B65;mysql&#x65B9;&#x5F0F;</p>
<h3 id="34-multicast"><a href="#34-multicast" class="headerlink" title="34.multicast"></a>34.<code>multicast</code></h3><p>1.server.php</p>
<p>&#x5E7F;&#x64AD;&#x6837;&#x4F8B;&#xFF0C;&#x672A;&#x6267;&#x884C;&#x6210;&#x529F;&#xFF0C;getSocket&#x672A;&#x5B9A;&#x4E49;</p>
<h3 id="35-lock-&#x4F7F;&#x7528;&#x9501;&#x6837;&#x4F8B;"><a href="#35-lock-&#x4F7F;&#x7528;&#x9501;&#x6837;&#x4F8B;" class="headerlink" title="35.lock &#x4F7F;&#x7528;&#x9501;&#x6837;&#x4F8B;"></a>35.<code>lock</code> &#x4F7F;&#x7528;&#x9501;&#x6837;&#x4F8B;</h3><h3 id="36-length"><a href="#36-length" class="headerlink" title="36.length"></a>36.<code>length</code></h3><p>&#x6BD4;&#x8F83;&#x5B8C;&#x5584;&#x7684;server&#x6837;&#x4F8B;&#xFF0C;&#x4F7F;&#x7528;&#x6253;&#x5305;&#x65B9;&#x5F0F;&#x4F20;&#x8F93;&#x6570;&#x636E;</p>
<p>1.server.php &#x57FA;&#x672C;&#x6837;&#x4F8B;</p>
<p>2.client.php &#x548C; async_client.php &#x57FA;&#x672C;&#x6837;&#x4F8B;</p>
<p>3.config.php &#x6CA1;&#x7528;&#x5230;</p>
<h3 id="37-ipv6"><a href="#37-ipv6" class="headerlink" title="37.ipv6"></a>37.<code>ipv6</code></h3><p>&#x6CA1;&#x4ED4;&#x7EC6;&#x770B;&#xFF0C;&#x57FA;&#x672C;&#x5C31;&#x662F;&#x914D;&#x7F6E;&#x533A;&#x522B;</p>
<h3 id="38-ide-helper"><a href="#38-ide-helper" class="headerlink" title="38.ide_helper"></a>38.<code>ide_helper</code></h3><p>phpstrom&#x7684;swoole&#x4EE3;&#x7801;&#x8865;&#x5168;&#x5E93;</p>
<p><a href="https://docs.phper.io/swoole/swoole-api-manual/docs" target="_blank" rel="external">swoole&#x5728;&#x7EBF;&#x6587;&#x6863;</a></p>
<h3 id="39-http"><a href="#39-http" class="headerlink" title="39.http"></a>39.<code>http</code></h3><p>1.server.php</p>
<p>&#x7B80;&#x5355;&#x670D;&#x52A1;&#x5668;&#x6837;&#x4F8B;&#xFF0C;&#x5BF9;&#x6587;&#x4EF6;&#x6709;&#x4E00;&#x4E9B;&#x64CD;&#x4F5C;</p>
<p>2.async_client.php</p>
<p>&#x6A21;&#x62DF;&#x6D4F;&#x89C8;&#x5668;&#x63D0;&#x4EA4;&#x6216;&#x8BF7;&#x6C42;&#x670D;&#x52A1;&#x5668;&#x8FD4;&#x56DE;,&#x548C; async_websocket.php &#x4E00;&#x8D77;&#x90FD;&#x4E0D;&#x80FD;&#x4F7F;&#x7528;&#xFF0C;&#x539F;&#x56E0;swoole_http_client&#x5DF2;&#x7ECF;&#x5E9F;&#x5F03;</p>
<p>3.client.php</p>
<p>&#x4F7F;&#x7528;get&#x548C;post&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#x8BF7;&#x6C42;&#x670D;&#x52A1;&#x5668;</p>
<p>4.curl.php</p>
<p>&#x4F7F;&#x7528;curl&#x8BF7;&#x6C42;&#x670D;&#x52A1;&#x5668;&#x8FD4;&#x56DE;&#x4FE1;&#x606F;</p>
<h3 id="40-future"><a href="#40-future" class="headerlink" title="40.future"></a>40.<code>future</code></h3><p>1.buffer.php</p>
<p>BufferInput &#x56DE;&#x8C03;&#x6CA1;&#x5B9A;&#x4E49;</p>
<p>swoole_buffer &#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5185;&#x5B58;&#x5BF9;&#x8C61;&#xFF0C;&#x53EF;&#x53C2;&#x89C1;21 buffer.php</p>
<p>2.coroutine.php</p>
<p>This is the pseudo code, Not implemented //&#x8FD9;&#x662F;&#x4F2A;&#x4EE3;&#x7801;&#xFF0C;&#x6CA1;&#x6709;&#x5B9E;&#x73B0;</p>
<p>3.mysql.php</p>
<p>&#x548C;swoole&#x6CA1;&#x4EC0;&#x4E48;&#x5173;&#x7CFB;&#x7684;mysqli&#x7B80;&#x5355;&#x6837;&#x4F8B;&#xFF0C;&#x4E0D;&#x660E;&#x6240;&#x4EE5;</p>
<p>4.node_message.php</p>
<p>&#x4E0D;&#x80FD;&#x8FD0;&#x884C;&#xFF0C;&#x5173;&#x4E8E;node&#x76F8;&#x5173;&#x90FD;&#x6CA1;&#x6709;&#x5B9A;&#x4E49;</p>
<p>5.table.php</p>
<p>&#x4F7F;&#x7528;swoole_table&#x5185;&#x5B58;&#x8868;&#x7684;&#x64CD;&#x4F5C;&#x6837;&#x4F8B;</p>
<h3 id="41-ext"><a href="#41-ext" class="headerlink" title="41.ext"></a>41.<code>ext</code></h3><p>&#x5176;&#x4ED6;&#x6269;&#x5C55;&#x7684;&#x5E38;&#x91CF;&#x548C;&#x51FD;&#x6570;&#x5B9A;&#x4E49;</p>
<h3 id="42-event"><a href="#42-event" class="headerlink" title="42.event"></a>42.<code>event</code></h3><p>1.inotify.php &#x4E0E; php/inotify.php &#x7C7B;&#x4F3C;</p>
<p>2.sockets.php</p>
<p>swoole_event_add(): fd argument must be valid PHP stream resource &#x4F20;&#x5165; socket_create &#x5B9E;&#x4F8B;&#x53D8;&#x91CF;&#x62A5;&#x9519;</p>
<p>3.stdin.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">swoole_event_add(STDIN, <span class="function"><span class="keyword">function</span><span class="params">($fp)</span> </span>{</div><div class="line">	<span class="keyword">echo</span> <span class="string">&quot;STDIN: &quot;</span>.fread($fp, <span class="number">8192</span>);</div><div class="line">});</div></pre></td></tr></table></figure>
<p>&#x7EC8;&#x7AEF;&#x8F93;&#x5165;&#x540E;&#x8F93;&#x51FA;</p>
<p>4.stream.php</p>
<p>stream_socket_client &#x8BFB;&#x4E8B;&#x4EF6;&#x56DE;&#x8C03;&#xFF0C;&#x5C06;&#x5BA2;&#x6237;&#x7AEF;&#x8FD0;&#x884C;&#x7684;&#x7ED3;&#x679C;&#x4F20;&#x5165;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x4E2D;</p>
<p>&#x5BA2;&#x6237;&#x7AEF;&#x63A5;&#x6536;&#x5230;&#x4FE1;&#x606F;&#x540E;&#x8C03;&#x7528;stream_onRead</p>
<p>5.test.php &#x4E0E; stream.php &#x7C7B;&#x4F3C;</p>
<h3 id="43-eof-&#x5206;&#x6BB5;&#x53D1;&#x9001;&#x63A5;&#x6536;"><a href="#43-eof-&#x5206;&#x6BB5;&#x53D1;&#x9001;&#x63A5;&#x6536;" class="headerlink" title="43.eof &#x5206;&#x6BB5;&#x53D1;&#x9001;&#x63A5;&#x6536;"></a>43.<code>eof</code> &#x5206;&#x6BB5;&#x53D1;&#x9001;&#x63A5;&#x6536;</h3><p>1.server.php</p>
<p>&#x53D1;&#x9001;100&#x6761;&#x4FE1;&#x606F;&#xFF0C;&#x6BCF;&#x6761;&#x4FE1;&#x606F;&#x5206;10&#x6BB5;&#x8FDB;&#x884C;&#x53D1;&#x9001;</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; <span class="number">1000</span>; $i++)</div><div class="line">{</div><div class="line">    $resp = str_repeat(<span class="string">&apos;A&apos;</span>, rand(<span class="number">10000</span>, <span class="number">50000</span>)) . <span class="string">&quot;\r\n\r\n&quot;</span>;</div><div class="line">    $serv-&gt;send($fd, $resp);</div><div class="line">    <span class="comment">//&#x5982;&#x679C;&#x6539;&#x6210;&#x5206;100&#x6BB5;&#x53D1;&#x9001;&#xFF0C;&#x4F1A;&#x6EA2;&#x51FA;&#x62A5;&#x9519;&#x5982;&#x4E0B;</span></div><div class="line">    <span class="comment">//ERROR	swReactorThread_send (ERROR 1008): connection#9 output buffer overflow.</span></div><div class="line">    <span class="keyword">if</span> ($i % <span class="number">10</span> == <span class="number">1</span>)</div><div class="line">    {</div><div class="line">        sleep(<span class="number">1</span>);</div><div class="line">        <span class="keyword">echo</span> <span class="string">&quot;send &quot;</span>.strlen($resp).<span class="string">&quot; bytes\n&quot;</span>;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>
<p>2.async_clinet.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//&#x6253;&#x5F00;EOF&#x68C0;&#x6D4B;,&#x5426;&#x5219;&#x4F1A;&#x4E00;&#x76F4;&#x62FC;&#x63A5;&#x6570;&#x636E;&#x5305;&#xFF0C;&#x76F4;&#x5230;&#x8D85;&#x8FC7;&#x7F13;&#x5B58;&#x533A;&#x6216;&#x8005;&#x8D85;&#x65F6;&#x624D;&#x4F1A;&#x4E2D;&#x6B62;&#x3002;</span></div><div class="line">$client-&gt;set(<span class="keyword">array</span>(<span class="string">&apos;open_eof_check&apos;</span> =&gt; <span class="keyword">true</span>, <span class="string">&apos;package_eof&apos;</span> =&gt; <span class="string">&quot;\r\n\r\n&quot;</span>));</div></pre></td></tr></table></figure>
<p>3.clinet.php</p>
<p>&#x7531;&#x4E8E;server.php&#x5F00;&#x542F;&#x4E86;EOF&#x68C0;&#x6D4B;&#xFF0C;&#x6240;&#x4EE5;&#x8BE5;&#x5BA2;&#x6237;&#x7AEF;&#x4EE3;&#x7801;&#x65E0;&#x6CD5;&#x8FDE;&#x63A5;&#x670D;&#x52A1;</p>
<h3 id="44-cpp-module-C-&#x7684;&#x7F16;&#x8BD1;&#x6837;&#x4F8B;"><a href="#44-cpp-module-C-&#x7684;&#x7F16;&#x8BD1;&#x6837;&#x4F8B;" class="headerlink" title="44.cpp_module C++&#x7684;&#x7F16;&#x8BD1;&#x6837;&#x4F8B;"></a>44.<code>cpp_module</code> C++&#x7684;&#x7F16;&#x8BD1;&#x6837;&#x4F8B;</h3><h3 id="45-client"><a href="#45-client" class="headerlink" title="45.client"></a>45.<code>client</code></h3><p>1.async.php </p>
<p>&#x4F7F;&#x7528;&#x4E86;&#x5524;&#x9192;&#x548C;&#x7761;&#x7720;&#x65B9;&#x6CD5;</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">$client-&gt;on(<span class="string">&quot;receive&quot;</span>, <span class="function"><span class="keyword">function</span><span class="params">(swoole_client $cli, $data)</span></span>{</div><div class="line">    <span class="keyword">echo</span> <span class="string">&quot;Receive: $data&quot;</span>;</div><div class="line">    $cli-&gt;_count++;</div><div class="line">    <span class="keyword">if</span> ($cli-&gt;_count &gt; <span class="number">5</span>)</div><div class="line">    {</div><div class="line">        <span class="comment">//&#x7761;&#x7720;&#x6A21;&#x5F0F;&#xFF0C;&#x4E0D;&#x518D;&#x63A5;&#x6536;&#x65B0;&#x7684;&#x6570;&#x636E;</span></div><div class="line">        <span class="keyword">echo</span> <span class="string">&quot;count=10, sleep(5000ms)\n&quot;</span>;</div><div class="line">        $cli-&gt;sleep();</div><div class="line">        $cli-&gt;_count = <span class="number">0</span>;</div><div class="line">        swoole_timer_after(<span class="number">5000</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> <span class="title">use</span> <span class="params">($cli)</span> </span>{</div><div class="line">            <span class="comment">//&#x5524;&#x9192;</span></div><div class="line">            $cli-&gt;wakeup();</div><div class="line">        });</div><div class="line">        <span class="comment">//$cli-&gt;close();</span></div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    }</div><div class="line">    <span class="keyword">else</span></div><div class="line">    {</div><div class="line">        $cli-&gt;send(str_repeat(<span class="string">&apos;A&apos;</span>, <span class="number">100</span>).<span class="string">&quot;\n&quot;</span>);</div><div class="line">    }</div><div class="line">});</div></pre></td></tr></table></figure>
<p>2.long_tcp.php &#x4F7F;&#x7528;&#x957F;&#x8FDE;&#x63A5;&#x5F62;&#x5F0F;</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">   <span class="comment">//&#x52A0;&#x5165;SWOOLE_KEEP&#x6807;&#x5FD7;&#x540E;&#xFF0C;&#x521B;&#x5EFA;&#x7684;TCP&#x8FDE;&#x63A5;&#x5728;PHP&#x8BF7;&#x6C42;&#x7ED3;&#x675F;&#x6216;&#x8005;&#x8C03;&#x7528;$cli-&gt;close&#x65F6;&#x5E76;&#x4E0D;&#x4F1A;&#x5173;&#x95ED;&#x3002;&#x4E0B;&#x4E00;&#x6B21;&#x6267;&#x884C;connect&#x8C03;&#x7528;&#x65F6;&#x4F1A;&#x590D;&#x7528;&#x4E0A;&#x4E00;&#x6B21;&#x521B;&#x5EFA;&#x7684;&#x8FDE;&#x63A5;&#x3002;</span></div><div class="line">$client = <span class="keyword">new</span> swoole_client(SWOOLE_TCP | SWOOLE_KEEP);</div></pre></td></tr></table></figure>
<p>3.select.php</p>
<p>&#x591A;&#x540C;&#x6B65;&#x963B;&#x585E;swoole_client&#xFF0C;swoole_client_select&#x505A;&#x5E76;&#x884C;&#x5904;&#x7406;</p>
<p>swoole_client&#x7684;&#x5E76;&#x884C;&#x5904;&#x7406;&#x4E2D;&#x7528;&#x4E86;select&#x6765;&#x505A;IO&#x4E8B;&#x4EF6;&#x5FAA;&#x73AF;&#x3002;</p>
<p>&#x8C03;&#x7528;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x4F1A;&#x8FD4;&#x56DE;&#x4E8B;&#x4EF6;&#x7684;&#x6570;&#x91CF;&#xFF0C;&#x5E76;&#x4FEE;&#x6539;$read/$write/$error&#x6570;&#x7EC4;&#x3002;&#x4F7F;&#x7528;foreach&#x904D;&#x5386;&#x6570;&#x7EC4;&#xFF0C;&#x7136;&#x540E;&#x6267;&#x884C;$item-&gt;recv/$item-&gt;send&#x6765;&#x6536;&#x53D1;&#x6570;&#x636E;&#x3002;</p>
<p>4.sync.php &#x963B;&#x585E;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;</p>
<p>5.test.txt &#x4E0D;&#x77E5;&#x9053;&#x4EC0;&#x4E48;&#x7528;</p>
<p>6.udp_async.php udp_sync.php upd&#x5BA2;&#x6237;&#x7AEF;&#x5F02;&#x6B65;&#x548C;&#x540C;&#x6B65;</p>
<h3 id="46-bench-&#x591A;&#x79CD;&#x8BED;&#x8A00;&#x5199;&#x7684;http&#x670D;&#x52A1;&#x53CA;&#x4F7F;&#x7528;ab&#x6D4B;&#x8BD5;&#x5BF9;&#x6BD4;"><a href="#46-bench-&#x591A;&#x79CD;&#x8BED;&#x8A00;&#x5199;&#x7684;http&#x670D;&#x52A1;&#x53CA;&#x4F7F;&#x7528;ab&#x6D4B;&#x8BD5;&#x5BF9;&#x6BD4;" class="headerlink" title="46.bench &#x591A;&#x79CD;&#x8BED;&#x8A00;&#x5199;&#x7684;http&#x670D;&#x52A1;&#x53CA;&#x4F7F;&#x7528;ab&#x6D4B;&#x8BD5;&#x5BF9;&#x6BD4;"></a>46.<code>bench</code> &#x591A;&#x79CD;&#x8BED;&#x8A00;&#x5199;&#x7684;http&#x670D;&#x52A1;&#x53CA;&#x4F7F;&#x7528;ab&#x6D4B;&#x8BD5;&#x5BF9;&#x6BD4;</h3><p>1.ab.sh </p>
<p>ab&#x6D4B;&#x8BD5;&#x547D;&#x4EE4;&#xFF0C;&#x8BBF;&#x95EE;&#x5E76;&#x53D1;&#x6027;&#x80FD;&#x548C;&#x63D0;&#x4EA4;&#x6570;&#x636E;&#x6027;&#x80FD;,</p>
<p>2.http.go &#x8C8C;&#x4F3C;go&#x5199;&#x7684;http&#x670D;&#x52A1;</p>
<p>3.http.js &#x4E5F;&#x8BB8;&#x662F;node.js&#x7684;&#x670D;&#x52A1;</p>
<p>4.http.php swoole&#x670D;&#x52A1;</p>
<p>5.http2.go go&#x670D;&#x52A1;2</p>
<p>6.redis.go &#x4F7F;&#x7528;go&#x63D0;&#x4F9B;redis&#x670D;&#x52A1;</p>
<p>7.run.php</p>
<p>&#x538B;&#x529B;&#x6D4B;&#x8BD5;&#x5DE5;&#x5177; c &#x8FDB;&#x7A0B;&#x6570;&#xFF0C; n &#x8BF7;&#x6C42;&#x6570;&#xFF0C; s &#x8BF7;&#x6C42;&#x5730;&#x5740;&#xFF0C; f &#x8BF7;&#x6C42;&#x65B9;&#x5F0F;&#xFF0C;&#x6240;&#x6709;&#x53C2;&#x6570;&#x5FC5;&#x987B;&#x5168;</p>
<p>&#x6839;&#x636E;f&#x53C2;&#x6570;&#x6307;&#x5B9A;swoole_client&#x8FDE;&#x63A5;s&#x8BF7;&#x6C42;&#x5730;&#x5740;</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Swoole_Benchmark</span></span></div><div class="line">{</div><div class="line">	<span class="keyword">public</span> $test_func;<span class="comment">//&#x6D4B;&#x8BD5;&#x6267;&#x884C;&#x7684;&#x51FD;&#x6570;</span></div><div class="line">	<span class="keyword">public</span> $process_num;<span class="comment">//&#x8FDB;&#x7A0B;&#x6570;&#xFF08;&#x5E76;&#x53D1;&#x6570;&#xFF09;</span></div><div class="line">	<span class="keyword">public</span> $request_num;<span class="comment">//&#x8BF7;&#x6C42;&#x6570;&#x91CF;</span></div><div class="line">	<span class="keyword">public</span> $server_url;<span class="comment">//&#x8BF7;&#x6C42;&#x5730;&#x5740;</span></div><div class="line">	<span class="keyword">public</span> $server_config;<span class="comment">//&#x8BF7;&#x6C42;&#x53C2;&#x6570;</span></div><div class="line">	<span class="keyword">public</span> $send_data;<span class="comment">//&#x6D4B;&#x8BD5;&#x6570;&#x636E;</span></div><div class="line">	<span class="keyword">public</span> $read_len;<span class="comment">//&#x6587;&#x4EF6;&#x6253;&#x5F00;&#x6570;</span></div><div class="line"></div><div class="line">	<span class="keyword">public</span> $time_end;<span class="comment">//&#x6D4B;&#x8BD5;&#x7ED3;&#x675F;&#x65F6;&#x95F4;</span></div><div class="line">	<span class="keyword">private</span> $shm_key;<span class="comment">//&#x65E5;&#x5FD7;&#x6587;&#x4EF6;</span></div><div class="line">	<span class="keyword">public</span> $main_pid;<span class="comment">//current process identifier</span></div><div class="line">	<span class="keyword">public</span> $child_pid = <span class="keyword">array</span>();<span class="comment">//&#x5B50;&#x8FDB;&#x7A0B;&#x96C6;&#x5408;</span></div><div class="line"></div><div class="line">	<span class="keyword">public</span> $show_detail = <span class="keyword">false</span>;<span class="comment">//&#x663E;&#x793A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;</span></div><div class="line">    ...</div></pre></td></tr></table></figure>
<p>7.tcp.go tcp&#x76D1;&#x542C;&#x670D;&#x52A1;</p>
<p>8.tcp.js tcp&#x76D1;&#x542C;&#x670D;&#x52A1;</p>
<p>9.udp.php swoole_server&#x670D;&#x52A1;&#x7B80;&#x5355;&#x6837;&#x4F8B;</p>
<p>10.websocket.php &#x7C7B;&#x4F3C;udp.php</p>
<h3 id="47-atomic"><a href="#47-atomic" class="headerlink" title="47.atomic"></a>47.<code>atomic</code></h3><p>test.php &#x539F;&#x5B50;&#x8BA1;&#x6570;&#x6837;&#x4F8B;</p>
<h3 id="48-async"><a href="#48-async" class="headerlink" title="48.async"></a>48.<code>async</code></h3><p>1.dns_lookup.php </p>
<p>swoole_async_dns_lookup&#x5C06;&#x57DF;&#x540D;&#x89E3;&#x6790;&#x4E3A;IP&#x5730;&#x5740;</p>
<p>2.read.php</p>
<p>swoole_async_read&#x5F02;&#x6B65;&#x8BFB;&#x6587;&#x4EF6;,&#x7A0B;&#x5E8F;&#x6B63;&#x5E38;&#x6267;&#x884C;&#xFF0C;&#x4F46;&#x4F1A;&#x62A5;&#x9519;Segmentation fault&#xFF0C;&#x539F;&#x56E0;&#x4E0D;&#x660E;</p>
<p>3.readfile.php &#x7C7B;&#x4F3C; read.php</p>
<p>4.write.php &#x7C7B;&#x4F3C; read.php</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/04/01/2016-04-01-tp-rw-separate/" rel="next" title="tp-rw-separate 读写分离笔记">
                <i class="fa fa-chevron-left"></i> tp-rw-separate 读写分离笔记
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/05/01/2016-05-01-burp-sqlmap/" rel="prev" title="burp-sqlmap笔记">
                burp-sqlmap笔记 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">

        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">categories</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">60</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#swoole扩展样例笔记1-8-4版本"><span class="nav-number">1.</span> <span class="nav-text">swoole扩展样例笔记1.8.4版本</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#追踪流程"><span class="nav-number">1.0.1.</span> <span class="nav-text">追踪流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置参数"><span class="nav-number">1.0.2.</span> <span class="nav-text">配置参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#基本概念"><span class="nav-number">1.0.3.</span> <span class="nav-text">基本概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-version-php-输出版本信息，例如-1-8-4"><span class="nav-number">1.0.4.</span> <span class="nav-text">1.version.php 输出版本信息，例如 1.8.4</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-timer-php-定时器样例"><span class="nav-number">1.0.5.</span> <span class="nav-text">2.timer.php 定时器样例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-test-buffer-php-以阻塞方式发送信息到服务器"><span class="nav-number">1.0.6.</span> <span class="nav-text">3.test_buffer.php 以阻塞方式发送信息到服务器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-swoole-http-client-php-swoole-http-client-已经被废弃"><span class="nav-number">1.0.7.</span> <span class="nav-text">4.swoole_http_client.php swoole_http_client 已经被废弃</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-swoole-php-swoole架构的说明文件"><span class="nav-number">1.0.8.</span> <span class="nav-text">5.swoole.php swoole架构的说明文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-swoole-process-php-将进程绑定到特定的CPU核上"><span class="nav-number">1.0.9.</span> <span class="nav-text">6.swoole_process.php 将进程绑定到特定的CPU核上</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-server-hot-update-opcache-php-热启动opcache服务"><span class="nav-number">1.0.10.</span> <span class="nav-text">7.server_hot_update_opcache.php 热启动opcache服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-server-php-多进程模式服务"><span class="nav-number">1.0.11.</span> <span class="nav-text">7.server.php 多进程模式服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-sendfile-server-php-发送数据"><span class="nav-number">1.0.12.</span> <span class="nav-text">8.sendfile_server.php 发送数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-recv-file-php-接收服务器发送的数据"><span class="nav-number">1.0.13.</span> <span class="nav-text">9.recv_file.php 接收服务器发送的数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-send-1m-svr-php-发送1m数据"><span class="nav-number">1.0.14.</span> <span class="nav-text">10.send_1m_svr.php 发送1m数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-recv-1m-client-php-接收1m数据"><span class="nav-number">1.0.15.</span> <span class="nav-text">11.recv_1m_client.php 接收1m数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-reflection-test-php-报告swoole-server类的有关信息"><span class="nav-number">1.0.16.</span> <span class="nav-text">12.reflection_test.php 报告swoole_server类的有关信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-redis-pool-php-redis连接池服务"><span class="nav-number">1.0.17.</span> <span class="nav-text">13.redis_pool.php redis连接池服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-db-pool-php-mysql和连接池服务"><span class="nav-number">1.0.18.</span> <span class="nav-text">14.db_pool.php mysql和连接池服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#15-proxy-sync-php-同步代理服务"><span class="nav-number">1.0.19.</span> <span class="nav-text">15.proxy_sync.php 同步代理服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-proxy-php-异步代理服务"><span class="nav-number">1.0.20.</span> <span class="nav-text">16.proxy.php 异步代理服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#17-mysql-proxy-server-php-mysql连接池"><span class="nav-number">1.0.21.</span> <span class="nav-text">17.mysql_proxy_server.php mysql连接池</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#18-multi-port-server-php-多连接同时服务"><span class="nav-number">1.0.22.</span> <span class="nav-text">18.multi_port_server.php 多连接同时服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#19-client2-php-阻塞连接，每秒发送信息到服务"><span class="nav-number">1.0.23.</span> <span class="nav-text">19.client2.php 阻塞连接，每秒发送信息到服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#20-c10k-php-最高10k长连接"><span class="nav-number">1.0.24.</span> <span class="nav-text">20.c10k.php 最高10k长连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#21-buffer-php-内存数据操作"><span class="nav-number">1.0.25.</span> <span class="nav-text">21.buffer.php 内存数据操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#22-websocket"><span class="nav-number">1.0.26.</span> <span class="nav-text">22.websocket</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#值得注意的是，封装的websocketclient-php使用了token进行了认证收发数据"><span class="nav-number">1.0.27.</span> <span class="nav-text">值得注意的是，封装的websocketclient.php使用了token进行了认证收发数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#23-unixsock"><span class="nav-number">1.0.28.</span> <span class="nav-text">23.unixsock</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#24-udp-简单的udp样例"><span class="nav-number">1.0.29.</span> <span class="nav-text">24.udp 简单的udp样例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#25-timer-简单定时器"><span class="nav-number">1.0.30.</span> <span class="nav-text">25.timer 简单定时器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#26-task-异步任务样例"><span class="nav-number">1.0.31.</span> <span class="nav-text">26.task 异步任务样例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#27-table-内存表"><span class="nav-number">1.0.32.</span> <span class="nav-text">27.table 内存表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#28-ssl"><span class="nav-number">1.0.33.</span> <span class="nav-text">28.ssl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#密钥生成参考"><span class="nav-number">1.0.34.</span> <span class="nav-text">密钥生成参考</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#28-server"><span class="nav-number">1.0.35.</span> <span class="nav-text">28.server</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#29-redis"><span class="nav-number">1.0.36.</span> <span class="nav-text">29.redis</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#30-process"><span class="nav-number">1.0.37.</span> <span class="nav-text">30.process</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#31-php"><span class="nav-number">1.0.38.</span> <span class="nav-text">31.php</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#32-packet"><span class="nav-number">1.0.39.</span> <span class="nav-text">32.packet</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#33-namespace"><span class="nav-number">1.0.40.</span> <span class="nav-text">33.namespace</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#33-mysql"><span class="nav-number">1.0.41.</span> <span class="nav-text">33.mysql</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#34-multicast"><span class="nav-number">1.0.42.</span> <span class="nav-text">34.multicast</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#35-lock-使用锁样例"><span class="nav-number">1.0.43.</span> <span class="nav-text">35.lock 使用锁样例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#36-length"><span class="nav-number">1.0.44.</span> <span class="nav-text">36.length</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#37-ipv6"><span class="nav-number">1.0.45.</span> <span class="nav-text">37.ipv6</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#38-ide-helper"><span class="nav-number">1.0.46.</span> <span class="nav-text">38.ide_helper</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#39-http"><span class="nav-number">1.0.47.</span> <span class="nav-text">39.http</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#40-future"><span class="nav-number">1.0.48.</span> <span class="nav-text">40.future</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#41-ext"><span class="nav-number">1.0.49.</span> <span class="nav-text">41.ext</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#42-event"><span class="nav-number">1.0.50.</span> <span class="nav-text">42.event</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#43-eof-分段发送接收"><span class="nav-number">1.0.51.</span> <span class="nav-text">43.eof 分段发送接收</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#44-cpp-module-C-的编译样例"><span class="nav-number">1.0.52.</span> <span class="nav-text">44.cpp_module C++的编译样例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#45-client"><span class="nav-number">1.0.53.</span> <span class="nav-text">45.client</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#46-bench-多种语言写的http服务及使用ab测试对比"><span class="nav-number">1.0.54.</span> <span class="nav-text">46.bench 多种语言写的http服务及使用ab测试对比</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#47-atomic"><span class="nav-number">1.0.55.</span> <span class="nav-text">47.atomic</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#48-async"><span class="nav-number">1.0.56.</span> <span class="nav-text">48.async</span></a></li></ol></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Neconano</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  

</body>
</html>
